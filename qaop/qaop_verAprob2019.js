// Qaop/JS Copyright by Jan Bobrowski 2011-2019
function script(n,t){var i=$("head"),u=i.appendChild($e("script"));u.onload=function(){i.removeChild(u),t&&t()},u.src=n}function request(c,o,n){var t,r;if(r=!(o=o||{}).nopb,c.data)return c.eof=1,a();if(t=c.file){c.type||(c.type=t.type),c.name||(c.name=t.name);var i=new FileReader;return(e=i.readAsArrayBuffer)?e.call(i,t):i.readAsBinaryString(t),void(i.onloadend=function(){c.data=i.result,e&&(c.data=new Uint8Array(c.data)),c.eof=1,a()})}var e={};function u(){var n={};o.acc&&(n.headers={Accept:o.acc}),fetch(c.url,n).then(function(n){if(c.type=c.type||n.headers.get("Content-Type"),n.status&&200!=n.status)return s(n.statusText);c.url=n.url;var u=+n.headers.get("Content-Length");if(e.t=u,e.b=0,o.text)n.text().then(function(n){v((c.data=n).length)});else{if(n.body){var t=n.body.getReader();return f()}n.arrayBuffer().then(function(n){n=new Uint8Array(n),v((c.data=n).length)})}function f(){return t.read().then(i)}function i(n){var t=n.done,i=n.value;if(i&&(e.b+=i.length,function(n){var t,i,u,f,o;t=c.data,u=c.pos,t&&(i=t.length,f=i-u)&&((o=new Uint8Array(f+n.length)).set(t.subarray(u,i)),o.set(n,f),n=o);c.data=n,c.pos=0}(i),r&&(e.t=e.b<u?u:e.b+9999,ui.progress(e))),!t)return a(),f();v(e.b)}}).catch(function(n){s(n)})}function a(){n&&n(c)}function v(n,t){c.eof=e.e=1,e.t=e.b=n,r&&ui.progress(e),t&&(c.data=null,ui.msg(t)),a()}function s(n){v(1,n||"Error")}this.fetch?u():script("qaop/fetch.js",u)}!function(){function pn(n,t,i){var u,f,o=n.className;for(null==o&&(o=(n=$(n)).className),o=(o+"").split(" "),i="+-"[+(null!=i&&!i)];f=(t=t.match(/([-+])?(\S+)\s*(.*)/))[1]||i,(u=o.indexOf(t[2]))<0?"-"==f||o.push(t[2]):"+"==f||o.splice(u,1),t=t[3];);return n.className=o.join(" "),n}function hn(n,t){return n.matches?n.matches(t):n.webkitMatchesSelector?n.webkitMatchesSelector(t):n.msMatchesSelector(t)}function mn(n){var t=document,i=t.activeElement,u=n.scrollIntoViewIfNeeded;if(u)return u.call(n);i==n?i.blur():(n.focus(),t.activeElement!=n&&(n.tabIndex=-1,n.focus(),delete n.tabIndex,n.removeAttribute("tabindex"))),i.focus()}emu=function(){var f,p,o,c,h={speed:1},r=["load"];h.init=function(n,t,i){h.zx=p=new t(i),p.rom48k=n.shift(),p.rom128=n,p.init(),o=window.requestAnimationFrame;try{!function(n){var t=this.AudioContext||this.webkitAudioContext;if(!t)throw"No audio";var i=new t,u=i.createScriptProcessor(2048,0,1);u.connect(i.destination);var f={hz:i.sampleRate,v:new Float32Array(8192),s:0,k:0,p:8191};u.onaudioprocess=function(l){var d=0,b=0,n=l.hz,k=Math.pow(2,-35e5/(700*n)),p=Math.pow(2,-35e5/(23256*n));return function(n){emu.h=void 0;var t,i=n.outputBuffer.getChannelData(0),u=l.v,f=l.s,o=l.p,c=i.length,r=l.k-f&o,e=c<r?c:r,a=d,v=b,s=0;if(0<e)for(;t=a+u[f],f=f+1&o,a=k*t,i[s++]=v=p*(v+t-a),--e;);if(l.s=f,0<(e=c-r)&&(v||a))for(;t=a,a*=k,i[s++]=v=p*(v+t-a),--e;);b=v,d=a}}(f),console.log(u),n(f),emu.h=function(){emu.h=void 0,i.resume()}}(p.audio),h.m=1}catch(n){ui.msg(n)}};var e,a,w,v=[],s=[,,,18247,,,,,17476,20303,,,,1542,,,0,3855,3855,,,,,,,,,17219,,,,,1799,,,,17219,25443,23644,21588,25700,,,,,,,,1028,771,2827,4883,6939,8995,9252,7196,5140,3084,,34957,,38542,,,,257,10023,6168,4369,4626,6425,8481,9766,5397,7710,5654,3598,5911,7967,3341,1285,514,6682,2313,8738,7453,8224,2570,4112,9509,2056,0,3855,,,,,,,,,,,,,,42919,38550,,40606,,41120,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,33950,,,,,,,,,,,,,34957,38542,39583,33950,41623,39072,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34204];function l(n){if(n=n?0:2,w)p.frame(n),i();else{for(var t=h.speed;t--;)e&&e(),p.frame(t?1:5|n);h.tape&&i()}}function i(){var i,n,u,f=w,o=p.cpu.getState();if(!(1&o.iff||(n=o.pc)<1387||1540<n)){o=p.getState(2);var c=[p.rom48k,o.ram[5],o.ram[2],o.ram[7&o.p7FFD]];if(f)i=f.pos,u=f.data.length;else{if(!(16&o.p7FFD))return;if(1507<=n&&1510==(n=d())&&(n=d()),n<1387||1403<=n)return;if(f=h.tape,u=f.data.length,f.blk|=0,f.eof&&f.blk>=u&&(f.blk=0),(i=f.blk+2)<=u)f.blk=i+(l(i-2)|l(i-1)<<8);else if(!f.eof)return;w=f,o.a=o.a_,o.f=o.f_,o.pc=n,o.hl&=255}for(var r=255&o.hl,e=o.hl>>8&255,a=o.ix,v=o.a,s=o.f;;){if(i==f.blk)return t(80);if(u<=i){if(f.eof)return t(80);break}if(r=l(i++),e^=r,!o.de)return t((v=e)<1|v-1&128|!(v-1)<<6|!(15&v)<<4|2);if(64&s){if(1&s)k(a,r);else if(v=b(a)^r)return t(0);a=a+1&65535,o.de--}else{if(v^=r)return t(0);s|=64}}return t(-1)}function t(n){if(o.ix=a,o.hl=e<<8|r,o.a=v,0<=n){s=n,o.pc=d(),w=null;var t=h.next_tape;t&&f.eof&&i==u&&(h.tape=t)}o.f=s,p.setState(o),f.pos=i}function l(n){var t=f.data;return 255&(t.charCodeAt?t.charCodeAt(n):t[n])}function d(){var n=o.sp;return o.sp=n+2&65535,b(n)|b(n+1&65535)<<8}function b(n){return c[n>>14][16383&n]}function k(n,t){16383<(n&=65535)&&(c[n>>14][16383&n]=t)}w=null}h.kbd=function(n,t,i){if(n==c||n===+n){for(var u=0;u<8;u++)p.keyboard[u]=255;e=null,n==c?v=[]:function(n,t,i){var u,f,o=p.keyboard;n:{for(u=0;u<v.length;u++)if(n==v[u]){t||v.splice(u,1);break n}t&&v.push(n)}for(u=0;u<v.length;u++){if((f=v[u])<0){if(null==(f=s[~f]))continue;switch(1&i&&(f>>=8),(f&=255)>>6){case 1:o[0]&=254,o[7]|=2;break;case 2:o[7]&=253,o[0]|=1}}o[7&f]&=~(1<<(f>>3&7))}}(n,t,i)}else!function(n){var t,i,u=0,f=0,o=0,c=p.keyboard;e=function(){if(!u){if(f==n.length)return void(e=null);if(!(i=1+"aq10p\n zsw29ol xde38ikmcfr47ujnvgt56yhb AQ  P  ZSW  OL XDE  IKMCFR  UJNVGT  YHB   !_\"  :  @);= \xa3  #( +.? <$' -,/ >%& ^* ~   \xa9   |       \\       {   ]   }   [".indexOf(n[f++])))return;3==(i=(i-(t=i%40))/40)&&(o^i?(f--,t=0):i--),o=i,c[0]=254|1&o^1,c[7]=253|2&o^2,c[7&t]&=~(1<<(t>>3)),u=5}3==--u&&(c[7&t]|=1<<(t>>3))}}(n)},h.stop=function(n,t){var i=r,u=i.indexOf(n);if(t){if(~u)return;i.length||o||clearInterval(f),i.push(n)}else{if(null==t)return 0<=u;if(u<0)return;if(i.splice(u,1),i.length)return;o?f||(f=1,function t(i){o(function(n){return r.length?f=0:n<i?t(i):(n<i+20?n=i:n<i+40&&(l(1),n=i+20),l(),void t(n+20))})}()):f=setInterval(l,20)}},h.canvas=function(n,t){var i=p.dim,u=1+(t>=2*i[1]);u!=a&&(a=u,n.width=i[0],n.height=u*i[1]),p.canvas(n,u)},h.reset=function(){p.setState({rom:null,ay:""}),p.reset()};var u={};function d(n,t,i){if(i&&u[n]&&u[n].abort(),u[n]=t)switch(n){case"tape":w=null;break;case"snap":h.stop(n,0)}}function b(n,t){var i;if(n=n.toLowerCase(),t)n=(i=n.match(/\S\.(\w{3})$/))&&i[1];else if(3<n.length&&(n=(i=n.match(/^(application|image)\/(x\.zx\.|x-spectrum-)([-.a-z0-9]+)/))&&i[3])&&"i"==i[1][0]&&"scr"!=n)return;if("slt"==n&&(n="z80"),n&&~["rom","sna","z80","tap","scr"].indexOf(n))return n}function k(n){return 1-/^48k?$|^0$/i.test(n)}return h.load=function(i,n,u){var f,o,c,r,e;function a(){h.tape={data:n.data,pos:0},c=function(){h.tape.data=n.data},r=function(){h.tape.eof=1}}function v(n){ui.progress({tap:"#0C3",rom:"#D04"}[n]||"#06F")}"string"==typeof n?n={url:n}:window.File&&n instanceof File&&(n={file:n}),"tape"==i&&a(),e=request(n,{},function(n){if(!c){if(n.type&&v(f=b(n.type)),!n.data)return d(i);if(f||v(f=b(n.name||n.url,1)),"rom"==f||"sna"==f||"z80"==f||"scr"==f)v(f),h.stop("snap",1),o={ram:(o=p.getState(2)).ram},c=function(a,u,n){u.pos|=0;var v=[],f={sna:[function(){l(),k({bc:13,de:11,hl:9,ix:17,iy:15,bc_:5,de_:3,hl_:1,a:22,f:21,a_:8,f_:7,sp:23,i:0,r:20}),a.im=v[25],a.iff=4&v[19]?3:0,a.border=7&v[26],64&v[26]&&(a.ay=!0);return[o(5),o(2),o(0),d,t]},s(v,0,27)],z80:[function(){l(),k({a:0,f:1,bc:2,hl:4,pc:6,sp:8,i:10,de:13,bc_:15,de_:17,hl_:19,a_:21,f_:22,iy:23,ix:25});var n=v[12],t=v[28];255==n&&(n=1);a.r=127&v[11]|n<<7&128,a.border=n>>1&7,a.halted=118==t,a.im=3&v[29],a.iff=!!v[27]|!!t<<1,v[29]>>6==1&&(a.joy=!0);if(!a.pc)return[s(v,30,32),e];if(32&n)var i=r();return a.ram=bytes(49152),[(i||s)(a.ram,0,49152)]},s(v,0,30)],rom:[function n(t){var i=v.length;if(0<t){for(var u=t;u--;)v.push(h());return[d,n]}for(;i&i-1;)i=v.push(255);for(;i<16384;)v=v.concat(v),i+=i;l();a.rom=v,a.pc=a.im=a.iff=0},d],scr:[function n(t){l();var i,u,f,o;i=a.ram[5];for(f=6912;f<16380;f++)i[f]=0;i[f++]=243,i[f++]=118,i[f++]=24,i[f]=252;a.pc=32764;a.halted=1,a.iff=a.border=a.model=0;if(0<t){var c=v.length;if(c){for(a.pFF=2,o=8192,f=0;f<768;f++)i[o++]=i[6144+f];i[o++]=v[0],r=[s(i,o,14335)]}else{v[0]=h();var r=[d,n]}return r}o=v[0];if(!(0<=o))for(u=[0,0,0,0,0,0,0,0],f=6911,e(63,-1),e(22,-32),e(31,1),e(22,32),f=o=0;f<8;f++)u[f]>u[o]&&(o=f);a.border=7&o;return[];function e(n,t){for(;u[i[f]>>3&7]++,f+=t,--n;);}},d,s(a.ram[5],0,6912)]}[n];if(!f)throw"Unknown format";function o(n,t){return(t=t||s)(n!=+n?n:a.ram[n],0,16384)}function s(n,t,i){return function(){for(;n[t]=h(),++t<i;);return[]}}function l(){a.model=a.pFF=a.halted=0,a.p7FFD=48,a.rom=null,a.ay=!1}function d(n){if(n)return[]}function t(n){if(0<n)return[s(v=[],0,4),c];var t=a.sp;return a.pc=i(t)|i(t+1)<<8,a.sp=t+2&65535,[];function i(n){return[[],a.ram[5],a.ram[2],a.ram[0]][n>>14][16383&n]}}function c(){k({pc:0}),a.model=1,a.p7FFD=t=v[2],(t&=7)&&(v=a.ram[0],a.ram[0]=a.ram[t],a.ram[t]=v);for(var n=[],t=0;t<8;t++)2!=t&&5!=t&&t!=(7&a.p7FFD)&&n.push(o(t));return n}function e(){var n,t,i,u,f=v[30]|v[31]<<8,o=32+f;if(v.length<o)return[s(v,32,o),e];if(k({pc:32}),n=v[34],t=0,(f<24?2:3)<n&&n<14&&(a.p7FFD=v[35],t=9==n?5:1),a.model=t,(a.tc2048=14==(-2&n))&&(a.pFF=v[36]),1&(n=v[37])||(a.r=128&a.r|128*Math.random()),4&n)for(u=[],a.ay={idx:v[38],reg:u},i=0;i<16;i++)u[i]=v[i+39];n:if(73<=f&&v[29]>>6==2){for(u=[],i=0;i<10;i+=2){var c=v[63+i],r=v[64+i];if(7<c||31<r||!r||r-1&r)break n;r=r<8?r>>1:16+r>>3,u.push(c|r<<3)}a.joy=u}return[d,b]}function b(n){if(0<n)return[s(v=[],0,3),i]}function i(){var n,t,i=v[0]|v[1]<<8,u=v[2];if(i|u)return(t=[[,2,0,,,5],[0,1,2,3,4,5,6,7]][0<a.model|0][u-3])!=+t&&(t=bytes(16384),u<2&&(a.rom=t)),i<65535&&(n=r()),[o(t,n),b]}function k(n){for(var t in n){var i=n[t];a[t]=v[i],t.match(/.[a-z]/)&&(a[t]|=v[i+1]<<8)}}function r(){var f,o=0;return function(t,i,u){return function(){n:for(;;)switch(o){case 0:do{if(f=h(),t[i]=f,++i==u)break n}while(237!=f);o--;case-1:if(237!=(f=h())){if(t[i]=f,++i===u)break n;o=0;break}o--,i--;case-2:if(!(f=h())){o=t.length-i;break}o--;case-3:var n=h();if(o=f,f=n,!o)break;default:do{if(t[i]=f,--o,++i===u)break n}while(o)}return[]}}}var p=[];function h(){var n=u.data,t=u.data.length,i=u.pos;if(t<=i)throw p;return u.pos=i+1,n.charCodeAt?255&n.charCodeAt(i):n[i]}return function(){try{for(var n;n=f.pop();){var t=u.data.length-u.pos,i=n(t||0-!!u.eof);if(!i)break;f=f.concat(i.reverse())}}catch(n){if(n!==p)throw n;if(u.eof)throw"Unexpected end of file"}if(n)return f.push(n)}}(o,n,f),r=function(){setTimeout(function(){h.stop("snap",0)},200)};else{if("tap"!=f)throw"Unknown file type";"snap"==i&&(d(i="tape",e,1),f=(f=(f=(f=n.type)&&f.match(/; *model *= *([^ ]+)/))&&k(f[1]))||p.getState().model,p.command('\xef""',f),d("snap"),a())}}if(c)try{var t=1;n.data&&c(),t=n.eof}finally{t&&(d(i),r&&r()),o&&(p.setState(o),u&&u(o))}}),d(i,e,1)},h.getType=b,h.setModel=function(n){return m=k(n),null!=m&&(m={model:m},p.setState(m)),m},h}(),function(p,h,a,e){var v,c=e.body,r=p.embed,b=$("#s"),k={e:$("#l"),w:256},m={e:$("#r"),w:272},s=setTimeout,l=location,d="application/json";function w(n){top.postMessage(n,"*")}var y,u,x,g,_,z=!(p.init=function(){var n,t;(onresize=F)(),onclick=N,onmousemove=onmouseout=onmouseup=ondragenter=ondragover=ondragleave=A,onmousedown=L,c.ontouchstart=c.ontouchmove=c.ontouchend=D,onkeydown=onkeyup=C,addEventListener("focus",E,1),addEventListener("blur",E,1),$("#c").oncopy=ondragstart=ondrag=ondragend=R,e.onpaste=ondrop=O,r||(v=localStorage,(n=function(){try{var n,t,i,u,f,o="qaop-state";if(n=v[o])for(v.removeItem(o),(f=JSON.parse(n.substr(1<<17))).ram=[],t=0;t<8;t++)for(f.ram[t]=u=bytes(16384),i=0;i<16384;i++)u[i]=n.charCodeAt(t<<14|i)}catch(n){p.msg(n)}return onunload=function(){var n=h.zx.getState(),t=n.ram;n.pause=h.stop("user"),n.volume=U,n.mute=S,n.speed=h.speed,delete n.ram,v[o]=t.reduce(function(n,t){return n+function(n){return String.fromCharCode.apply(String,n)}(t)},"")+JSON.stringify(n)},f}())||s(function(){p.msg("F9 - menu",5e3)},300)),(t=X(r)||{})["!"]&&(n={iff:0,halted:1,volume:n&&n.volume});var i=0;r||(n&&(h.stop("user")^n.pause&&p.cmd("pause"),q(n)),on($(".tabv>:last-child")),i=t.snaps<<1|!!t.u<<1|t.menu,p.show(3,3)),onhashchange=function(){Y(X())},s(function(){n||(t.reset=1),Y(t),h.stop("load",0)}),s(function(){p.show(3,i)}),(t.snaps||t.menu)&&Z(/./);var u="files"in $("input[type=file]"),f=h.m;pn(c,f?"+audio":"+noaudio"),$$(".c-pause,.c-reset,.c-128,.c-ay,.c-remember,.c-save"+(u?",.c-open":"")+(f?",#vol,.c-mute":"")).forEach(function(n){n.disabled=0}),b.ondblclick=function(){p.cmd("pause")},b.draggable=!0,r||((onstorage=P)(),V()),c.removeChild($("#splash"));var o=a.applicationCache;o&&function(n){$("h1").onclick=function(){p.cmd("update")},n.onupdateready=function(){W=1,n.swapCache(),pn(c,"+update")}}(o),onmessage=function(n){var t,i,u,f=n.data;if(f===f+""?(t=f.match(/^([^ ]+) ([^ ]+)/))?(i=t[1],u=t[2]):i=f:i=f.cmd,i)switch(i){case"load":(u||f)&&p.load(u||f);break;case"model":u&&T(h.setModel(u));break;case"keydn":case"keyup":u&&h.kbd(+u,"keydn"==i);break;default:u&&p.cmd(i,u)}else q(f)},w({volume:U})}),S=!1,U=.5;function o(n,t){$$(n).forEach(function(n){pn(n,"active",t),n.checked=t})}function T(n){var t,i,u=j,f={pause:z,mute:S,volume:U};o(".c-mute",S),pn(c,"mute",S),$("#vol>*>*").style.width=100*U+"%",o(".c-pause",z),pn(c,"pause",z),(t=n.model)!=i&&(o(".c-128",t=!!t),u[128]=(f[128]=t)||i),(t=function(n,t){return null==n?t:n}(n.ay,t))!=i&&(o(".c-ay",t=!!t),u.ay=(f.ay=t)||i),(t=n.tc2048)!=i&&(t=!!t,u.tc2048=(f.tc2048=t)||i),r&&w(f)}function q(n){var t,i,u;h.zx.setState(n),(t=n.volume)!=u&&(U=0<t?1<t?1:t:0,i=1),(t=n.mute)!=u&&(S=!!t,i=1),i&&h.zx.volume(S?0:U),(t=n.speed)!=u&&(h.speed=1<t?0|t:1),T(n)}function F(){var n,t,i,u,f,o,c=3&y,r=h.zx.dim,e=innerWidth,a=innerHeight,v=e,s=a,l=0;switch(0<(n=512-e)&&(e+=n>>3),c&&(e=15*e>>4,l=a>>5,u=s-(a=15*a>>4)>>2),n=r[0]*a,(t=r[1]*e)<n?a-=a-t/r[0]|0:e-=e-n/r[1]|0,i=v-e>>1,f=k.w,o=m.w,t=v-48,c){case 1:t<f&&(f=t),i<(n=f+u)&&(i=n);break;case 2:t<o&&(o=t),(n=v-e-o-u)<i&&(i=n);break;case 3:(t>>=1)<f&&(f=t),t<o&&(o=t)}var d=$("#c").style;d.width=e+"px",d.height=a+"px",d.left=i+"px",d.top=l+"px",(d=k.e.style).left=(1&c?0:-k.w)+"px",d.width=f+"px",(d=m.e.style).right=(2&c?0:-m.w)+"px",d.width=o+"px",h.canvas(b,a),n=s-a,I=!c&&127<n?a:0,(d=$("#k").style).height=n+"px",d.display=I?"block":"none",I&&J(v,n,a)}function L(n){if(u=e.activeElement,$("#vol").contains(n.target))return fn(n)}function N(n){var t,i=n.target;if((t=i.className)&&t.match&&(t=t.match(/\bc-(\S+)/)))i.disabled||p.cmd(t[1]);else{if(hn(i,"#s,button"))return"s"==i.id&&(i=$("#c")),void i.focus();if($("#vol").contains(i))return fn(n);i=e.activeElement,dn(n,u!=i&&"click+focus"),u=i}}function A(i){var n=i.type,t=[i.pageX,i.pageY];if("mouseout"!=n){if(x)return x(i,n,t);var u,f,o=g;return g=t,"m"!=n[0]&&(u=O(i)),!o||(f=t[0]-o[0])||t[1]-o[1]?(pn(c,"+move"),clearTimeout(_),_=s(function(){if(pn(c,"-move"),o){var n,t=i.target;if(hn(t,".tabv>button"))return t.focus();dn(i,"hover")||(n=o[1])<32||innerHeight-n<33||I&&I<=n||(n=o[0],f<=0&&n<32&&p.show(1,1),0<=f&&innerWidth-n<33&&p.show(2,2))}},200),u):u}null===i.relatedTarget&&clearTimeout(_)}function C(n){var t,i=n.target,u=n.keyCode,f=n.type,o="keydown"==f,c=n.ctrlKey,r=h.stop("user");if(45==u&&(t=$("[rel=search]"))&&t.click(),119==u){var e=$("#kh");if(!e.children[0]){var a=new Image;a.src="qaop/keyboard.svg",e.appendChild(a)}return e.style.display=o?"block":"none",void h.stop("kh",o)}n:if(!y&&(u<112||123<u)&&19!=u&&46!=u){if((27==u||32==u)&&o&&r)p.cmd("pause");else if(32<u&&u<35)fn(n);else{if(r)break n;"keypress"!=f&&h.kbd(~u,o,n.shiftKey+2*(c|n.altKey|n.metaKey))}return function(n,t){t=this.location,/^\w+:..t[^.]+k\.c/.test(t)||s(function(){h.kbd()},2e4)}(),bn(n)}if((t={19:"pause",112:"help",113:"remember",114:"restore",116:"update",121:"mute"}[u])&&bn(n),o)if(t)p.cmd(t);else{if(c)return t={46:"reset",79:"open",83:"save"}[u],46==u&&h.kbd(),p.cmd(t),bn(n);if(27!=u&&120!=u||p.show(3,27==u?0:3^y&&3),"vol"!=i.id||u-38&-3||fn(n),"BUTTON"==i.nodeName)if(37==u||39==u){for(t=37==u?"previous":"next";(i=i[t+"ElementSibling"])&&i.hidden;);i&&"BUTTON"==i.nodeName&&i.focus()}else 40==u&&(t=i.dataset.down)&&$("#"+t).focus();dn(n)}}function E(n){var t=n.target;if(t!=a){var i="focus"==n.type;if("c"==t.id)return i?void p.show(3,0):(h.kbd(),void s(function(){e.activeElement==t||y||p.show(3,3)}));i&&(hn(t,"#l *")&&p.show(1,1),hn(t,"#r *")&&p.show(2,2),hn(t,".tabv>button")&&on(t))}}function O(n){var t,i=n.type,u=n.dataTransfer||n.clipboardData;if(u.dropEffect="copy",bn(n),"drop"!=i&&"paste"!=i)return!1;(t=u.files)&&(t=t[0])||(t=u.getData("URL"))?p.load(t):(t=u.getData("Text"))&&h.kbd(t)}function R(n){var t=n.type,i=n.dataTransfer||n.clipboardData,u=n.target;if(u!=b&&"c"!=u.id)return dn(n);if("dragstart"==t||"copy"==t){un(i);var f,o=$e("canvas"),c=$e("img"),r=h.zx.dim;o.height=f=r[1]>>1,o.width=r=r[0]>>1,o.getContext("2d").drawImage(b,0,0,b.width,b.height,0,0,r,f),c.src=o.toDataURL(),i.setDragImage(c,r/2,f/2)}return!0}p.cmd=function(n,t){var i,u=null==t;switch(n){case"pause":u&&(t=!h.stop("user")),z=!!t,h.stop("user",t),T({}),K(),t&&h.kbd();break;case"reset":h.reset(),Z();break;case"open":var f=$("#open");f.onchange=function(){var n=f.files[0];n&&p.load(n),f.value=""},f.click();break;case"save":try{/\.z80$/i.test(t=t||"snapshot")||(t+=".z80"),Q(t,tn())}catch(n){p.msg(n)}break;case"128":u&&(t=!h.zx.getState().model),q({model:+t});break;case"ay":u&&(t=!h.zx.getState().ay),q({ay:+t});break;case"mute":u&&(t=!S),q({mute:+t});break;case"remember":!function(){var n,t,i,u,f,o=new Date;for(n=[o.getMonth()+1,o.getDate(),o.getHours(),o.getMinutes()].reduce(function(n,t,i){return n+"-- :"[i]+("0"+t).substr(-2)},o.getFullYear()),i=en.snaps,f=0,t=n;!((u=i.o.indexOf(t))<0||u==i.sel);t=n+" ("+ ++f+")");u=i.sel;try{0<=u&&v.removeItem("zx/"+i.o[u]),v["zx/"+t]=tn()}catch(n){return p.msg(n)}u<0?pn(i.e[u=sn(i,t,t)],"+sel"):i.e[u].firstChild.textContent=i.o[u]=t;i.act("sel",i.sel=u),V()}();break;case"restore":e().act("click",i.sel);break;case"rmsna":e().act("del",i.sel);break;case"svsna":if(v){var o=e().o[i.sel],c=v["zx/"+o];c.match(/^data:/)&&Q(o+".z80",c)}break;case"update":var r=a.applicationCache;if(r&&!W)switch(r.status){case 1:r.update();case 2:case 3:return}Z(/./),l.reload();break;case"help":$("[rel=help]").click()}function e(){return i=en.snaps}},p.load=function(n,t){t||Z(),h.load("snap",n,T)},p.show=function(n,t){r&&(t&=-4);var i=y&~n^t;return i==y||(3&(y^i)&&pn(c,"anim",null!=y),pn(c,"full",!(3&i)),y=i,F(),$("#c")[3&i?"blur":"focus"]()),i};var I,f,J,M=[];function D(n){M=[].map.call(n.touches,function(n){return[n.pageX,n.pageY]}),f();var t=n.type[5];"m"==t&&bn(n),"e"==t&&h.h&&h.h()}!function(){var u;$("#k").onmousedown=function(n){M[0]||(u=[n.pageX,n.pageY],f(),x=function(n,t,i){"m"==t[5]?u=i:x=u=null,f()},h.stop("user")&&p.cmd("pause"))};var v,s,l,d,b,k,o=[];f=function(){var n=M;for(var t in u&&(n=n.slice()).push(u),I&&n.map(function(n){var t,i,u,f=n[1]-v;0<=f&&(i=f/l|0)<4&&f-i*l<s&&0<=(t=n[0]-d)&&(u=t/k|0)<10&&t-u*k<b&&(o[u=u<5?3-i|u<<3:4+i|9-u<<3]|=2)}),o){var i=o[t];i&&(i<3&&h.kbd(+t,1<i),o[t]=i>>1)}},J=function(n,t,i){var u=n>>7;d=n-10*(k=(n-(v=u))/10|0)+u>>1,(b=k-u)<(s=(l=t-u>>2)-u)&&(l=(s=b)+u);var f=$("#k"),o=0,c=v,r=d;do{var e=f.children[o];e||((e=f.appendChild($e("div"))).textContent="1234567890QWERTYUIOPASDFGHJKL\u21b5\u21e7ZXCVBNM\u25c6 "[o]);var a=e.style;a.top=c+"px",a.left=r+"px",a.width=b+"px",a.height=s+"px",r+=k,++o%10||(c+=l,r=d)}while(o<40);v+=i}}();var W,B,H,j={};function X(n){var t,i,u,f,o=l.hash.substr(1),c=$("#bb"),r=decodeURIComponent;if(n||o!=c.value){for(c.value=o,t={};o;){if(i=o.match(/^!([^#]*)#?(.*)/))u="!",f=r(i[1]),o=i[2];else{if((i=o.match(/^(~?)([^=#%./]*)([./]?)(?:=([^#]*))?#?(.*)/))[3]){t.l=o;break}u=i[2],f=!i[1]&&(null==i[4]||r(i[4])),o=i[5]}t[u]=f}return t}}function Y(n){if(n){var t,i,u,f,o=j;o.u!=n.u&&(o.u=u=n.u,(t=$("[data-for=userg]")).hidden=!u,t.style.display=u?"":"none",function(n,t){var c=an(n);c.rq&&c.rq.abort();if(null==t)return;c.act=rn;var r=$e("a");r.href=t,c.rq=request({url:r.href},{text:1,acc:d+",text/plain,text/html",color:"#EC0"},function(n){if(n.eof){delete c.rq,c.ul.innerHTML="";var t=n.type,i=n.data;if(i&&t){t=t.replace(/ *;.*/,"");var u,f=e.head,o=$e("base");o.href=n.url,f.insertBefore(o,f.firstChild);try{!function(){if(t==d){if(!(u=JSON.parse(i)).forEach)throw"Not a table"}else u=(u="text/html"==t?((u=$e("div")).innerHTML=i,[].map.call(u.querySelectorAll("a:not([rel=up])"),function(n){return{url:n.href,name:n.textContent}})):i.split(/\n+/).map(function(n){var t=n.match(/^(\S+)\s*(.*)/);if(t)return{url:t[1],name:t[2]}})).filter(function(n){if(n&&n.url)return n.name||(n.name=n.url.replace(/.*\//,"")),n})}(),u.forEach(function(n){var t=n.name,i=n.url;t&&i&&sn(c,t+"",{url:(r.href=i,r.href)})})}catch(n){p.msg(n)}f.removeChild(o)}}}),c.ul.innerHTML="\u2652"}("user",u||null),u&&t.focus()),(u=n["!"])&&(f=u.match(/^([a-z0-9]+)(:[a-z0-9]+)?$/))?(o.l=null,p.load("/qaop/bin/"+u,1),cn.hasOwnProperty(u)?G():(cn[f[1]]=null,request({url:"/qaop/inf/"+f[1]},{text:1,acc:d,nopb:1},function(n){var t=n.data;if(t){var i=JSON.parse(t),u=i.id;u&&(cn[u]=i,G())}}))):o.l!=n.l&&(o.l=i=n.l);var c,r={};(u=n[128])!=c&&(r.model=+!!u),(u=n.tc2048)!=c&&(r.tc2048=+!!u),(u=n.ay)!=c&&(r.ay=+!!u),(u=n.speed)!=c&&(r.speed=u),q(r),n.reset&&h.reset(),i&&p.load(i)}}function Z(n){var t=l.href.replace(/#.*/,"");(n||/^#!/).test(l.hash)&&history.replaceState(null,null,t),onhashchange()}function G(){var n=l.hash.match(/^#!([a-z0-9]+)/),t=B,i=H,u=$("link[rel=manifest]");n&&(t||(t=B=e.title),!i&&u&&(i=H=u.href),(n=cn[n[1]])&&(t=n.name+" \u2022 ZX Spectrum online",i="qaop/mnf/"+n.id)),t&&(e.title=t),i&&u&&(u.href=i)}function K(){var o=$("link[rel~=icon]"),c=new Image;function n(){var n,t,i,u=$e("canvas"),f=u.getContext("2d");u.width=n=c.width,u.height=t=c.height,f.drawImage(c,0,0),h.stop("user")&&(f.scale(n/16,t/16),f.fillStyle="#FFF",f.fillRect(9,9,7,7),f.fillStyle="#33C",f.fillRect(10,10,2,5),f.fillRect(13,10,2,5)),(o=(i=o).cloneNode(1)).type="image/png",o.href=u.toDataURL(),kn(i).replaceChild(o,i)}c.src=o.href,c.onload=function(){(K=n)()}}function P(){var n,t,i=an("snaps"),u=[],f=i.o.slice();for(n=0;n<v.length;)/^zx\/./.test(t=v.key(n++))&&u.push(t.substr(3));u.sort(),u=u.filter(function(n){var t=f.indexOf(n);if(t<0)return 1;delete f[t]}),f.forEach(function(n,t){ln(i,t)}),u.forEach(function(n){sn(i,n,n)}),i.act=nn}function Q(n,t){var i=$("#save");i.href=t,i.textContent=i.download=n,i.click()}function V(){$(".c-restore").disabled=!en.snaps.o.length}function nn(n,t,i){var u=this,f=u.o.length;switch(n){case"click":i||$("#c").focus();case"drag":var o=u.o[t]||u.o[f-1],c=o&&v["zx/"+o];if(!o||!c)return;if("drag"==n)return un(i,o,c);p.load(c);break;case"sel":$(".c-svsna").disabled=$(".c-rmsna").disabled=t<0,0<=t&&mn(u.e[t]);break;case"del":0<=t&&(v.removeItem("zx/"+u.o[t]),ln(u,t),V())}}function tn(n){return"data:application/x.zx.z80;base64,"+btoa(function(u){var n,f=[];if(function(n){for(var t in n){var i=n[t];f[i]=255&u[t],t.match(/.[a-z]/)&&(f[i+1]=u[t]>>8)}}({a:0,f:1,bc:2,hl:4,pc:32,sp:8,i:10,r:11,de:13,bc_:15,de_:17,hl_:19,a_:21,f_:22,iy:23,ix:25}),f[12]=u.r>>7&1|u.border<<1|32,n=u.iff,f[27]=1&n,f[28]=2&n&&(u.halted?118:1),f[29]=80|u.im,n=u.model,f[34]=n?5==n?9:3:u.tc2048|u.pFF?14:0,f[35]=u.p7FFD,f[36]=0|u.pFF,n=3,u.ay){for(f[38]=u.ay.idx,n=0;n<16;n++)f[39+n]=u.ay.reg[n];n=7}f[37]=n,f.length=32+(f[30]=23);var e=String.fromCharCode,a=e.apply(0,f);if(u.model){var t,i=5|u.p7FFD>>2&2;for(o(i+3,i),t=0;t<8;t++)t!=i&&o(t+3,t)}else o(8,5),o(4,2),o(5,0);return(f=u.rom)&&c(1,f,0),a;function o(n,t){c(n,u.ram[t],0)}function c(n,t,i){var u,f,o,c=i+16384,r="";do{for(u=t[i],f=1;t[++i]===u&&f<255;)f++;if(o=e(u),4<f||237==u&&1<f)r+="\xed\xed"+e(f)+o;else{for(;r+=o,--f;);237==u&&i<c&&(r+=e(t[i++]))}}while(i<c);f=r.length,a+=e(255&f,f>>8,n)+r}}(n||h.zx.getState()))}function un(n,t,i,u,f){if(i=i||tn(),n.setData("URL",i),!u){if(!(u=i.match(/^data:([^,;]+)/)))return;u=u[1]}(f=f||h.getType(u))&&(t=(t||"snapshot")+"."+f,n.setData("DownloadURL",u+":"+t.replace(/:/g,"")+":"+i))}function fn(n){var f,t,i=U,o=n.pageX;switch(n.type){case"keydown":(t={33:1,34:-1,37:-1,38:1,39:1,40:-1}[n.keyCode])&&(u(i+.1*t),f=1);break;case"mousedown":if(t=$("#vol>*>*>*").getBoundingClientRect(),(o-=t.left)<0||o>=t.width)return;o-=t.width/2,x=function(n,t,i){if(c(i[0]-o),f=1,"mouseup"==t){if(f){var u=onclick;onclick=null,s(function(){onclick=u})}x=null}};break;case"click":c(o)}return f;function c(n){var t=$("#vol>*").getBoundingClientRect();u((n-t.left)/t.width)}function u(n){q({volume:n<0?0:1<n?1:n})}}function on(u){[].forEach.call(kn(u).children,function(n){var t=n.getAttribute("data-for"),i=n==u;pn(n,"active",i),n.tabIndex=i-1,t&&($("#"+t).style.visibility=i?"visible":"hidden")})}var cn={};function rn(n,t){if("click"==n){$("#bb").value="";var i=this.o[t];i.id?(l.hash="#!"+i.id,onhashchange()):p.load(i.url),$("#c").focus()}}var en={snaps:{ul:$("#snaps")},user:{ul:$("#userg")}};function an(n){var t=en[n];return t.e=[],t.o=[],t.sel=-1,t.ul.innerHTML="",t}function vn(n,i){0<=i&&mn(n.e[i]),n.e.forEach(function(n,t){pn(n,"sel",t==i)}),n.act("sel",n.sel=i)}function sn(n,t,i){var u=$e("li"),f=u.appendChild($e("a"));return f.textContent=t,n.ul.appendChild(u),n.e.push(u),f.draggable=!0,n.o.push(i)-1}function ln(n,t){n.ul.removeChild(n.e[t]),n.e.splice(t,1),n.o.splice(t,1);var i=n.sel;vn(n,i-=t<i||i==t&&t==n.e.length)}function dn(n,t){if(i=function(n){var t,i,u,f;for(f in hn(n,".ls>li>a")?n=kn(t=kn(i=n)):hn(n,".ls>li")&&(n=kn(n)),en)if((u=en[f]).ul==n)return{l:u,i:u.e.indexOf(t),e:t,a:i}}(n.target)){var i,u=i.l,f=i.i,o=u.sel;switch(t||n.type){case"click":o=f;case"click+focus":0<=f&&!(1<n.which)&&u.act("click",f,n.ctrlKey);break;case"hover":0<=f&&(o=f);break;case"keydown":switch(n.keyCode){case 38:0<o&&o--;break;case 40:o+1<u.e.length&&o++;break;case 13:0<=o&&u.act("click",o,n.ctrlKey);break;case 46:return u.act("del",o),1;case 27:o=-1;break;default:return void u.act("key",-1,n)}bn(n);break;case"dragstart":if((o=f)<0)break;u.act("drag",f,n.dataTransfer)}return u.sel!=o&&vn(u,o),1}}function bn(n){n.preventDefault()}function kn(n){return n.parentNode}addEventListener("transitionend",function(){pn(c,"-anim")})}(ui,emu,window,document),setTimeout(function(n,t){n=n("L3RvcmluYWsu"),(!t||t.href.indexOf(n)<0)&&emu.stop(n,1)},1e6,atob,$("a[rel=author]")),ld(function(n){var s=this;s.cpu=new n(s),s.devs=[],s.keyboard=[255,255,255,255,255,255,255,255];var a,l,v,c,d,b,k,p,h,m,w,$,y=24;function t(n){var t,i,u,f,o,c=n.pFE,r=16384;if(c!=f&&(_=c),c=n.border,t=_,c!=f&&(_=248&t|c),o=7&(t^_),nn=7&_,"rom"in n&&(m=n.rom),c=n.model,(t=n.p7FFD)!=+t&&(t=z),c!=f&&(y=-26&y|0<(c=5==c?c:+!!c)|(c<5?24:0),l=(a=[[69888,14335,224,32],[70908,14361,228,32],,,,[71680,17989,224,36]][c])[2],v=191*l+126,h=s.rom128[1],1&y||(h=s.rom48k,k!=p[0]&&x(p[0]=bytes(r),0,k,0,r),t=48)),o|=8&(t^z),U(t),c=n.tc2048,t=n.pFF,(c!=f||n.model)&&(y=-5&y|c<<2,c||(t|=0)),t==+t&&(S=t),(c=n.cont)!=f&&(y&=-9,w&=-16,c&&(y|=8,w|=2|(1&z)<<3)),(c=n.fbus)!=f&&(y=-17&y|!!c<<4),(c=n.joy)!=f&&(c?s.joy&=255:s.joy=f),c=n.ram)if(o=1,8<(u=c.length))x(d,0,c,0,r),x(b,0,c,r,r),x(k,0,c,32768,r);else for(;u;)(i=c[--u])&&p[u]!=i&&x(p[u],0,i,0,r);if((c=n.ay)==f&&(c=n.model),""===c&&(c=!!kn,kn=f),c){if(kn||(kn={idx:0,reg:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],volt:[0],avol:0,bvol:0,cvol:0,mix:0,gen:0,aper:0,bper:0,cper:0,nper:0,eper:0,dis:0,ech:0,ekeep:0,ealt:0,eattack:0,estep:0,ecnt:0,noise:1},hn()),c.reg)for(t=0;t<15;t++)c.reg[t]!=f&&mn(t,0|c.reg[t]);(t=c.idx)!=f&&(kn.idx=15&t)}else c!=f&&(kn=f);if((c=n.time)==+c&&(s.time=c-a[1]),o&&B){var e=s.time;g(2),s.time=e}s.cpu.setState(n)}function x(n,t,i,u,f){for(;n[t++]=0|i[u++],--f;);}function g(n){H||o(),J=(1&S)<<13,I=0,D=L*G,M=L*(F+32+F)+F-1;var t=-l*L-4*F+4;Q=-F,V=-L,P=t,2&n&&(W(u=s.time),un(u));var i=a[0]-a[1];if(1&n?(4&y&&64&S||(s.int=255,s.time_limit=a[3]-a[1],s.cpu.execute()),s.int=-1,s.time_limit=i,s.cpu.execute()):s.time=i,2&n){var u;if(W(u=s.time),nn!=tn){var f=P;un(u),f==t&&(tn=nn)}R&&fn(R)}s.time-=a[0]}s.init=function(){p=[];for(var n=0;n<8;n++)p[n]=bytes(16384);for(c=rom=h,d=p[5],b=p[2],k=p[0],w=226,$=d,t({model:0}),s.time=-a[1],n=6144;n<6912;)d[n++]=7;for(E=[],n=N*A/8;E[--n]=0,n;);B&&i()},s.reset=function(){s.cpu.reset(),nn=0,U(1&y?0:48);var n,t,i=s.time,u=s.devs,f=u.length;for(n=0;n<f;n++)(t=u[n]).reset&&t.reset(i)},s.canvas=function(n,t){H=null,B=n.getContext("2d"),X=t||1,E&&i()},s.getState=function(n){var t,i,u=s.cpu.getState(),f=16384;if(u.pFE=_,u.border=nn,u.p7FFD=z,u.model=1&y&&(8&y?1:5),u.tc2048=!!(4&y),u.cont=!!(8&y),u.fbus=!!(16&y),u.joy=null!=s.joy,u.pFF=S,u.ay=kn&&{idx:kn.idx,reg:kn.reg.slice()},u.time=s.time+a[1],u.frt=a[0],1==n)x(t=bytes(3*f),0,d,0,f),x(t,f,b,0,f),x(t,32768,k,0,f);else for(t=[],i=0;i<8;i++)t[i]=p[i],1<n&&x(t[i]=bytes(f),0,p[i],0,f);return u.ram=t,m&&(u.rom=m),u},s.setState=t,s.frame=function(n){if(!--O){O=16;for(var t=128;t<256;t++){var i=C[t];i=i<<4&61440|i>>4&3840,C[t]=i}}for(var u=s.time,f=a[0],o=(t=0,s.devs),c=o.length;t<c;t++){var r=o[t];r.frame&&r.frame(f,u,n)}on=50*f,g(n),K&&(bn(f+u),vn=u)},s.time=s.time_limit=0,s.m1=function(n,t){var i,u;u=n<32768?n<16384?(i=c,1):(i=d,2):n<49152?(i=b,4):(i=k,8);var f=s.time-r;return 0<f&&T(f),w&u&&e(0),r=w&1<<(t>>14)?s.time+4:99999,i[16383&n]},s.get=function(n){var t,i;i=n<32768?n<16384?(t=c,1):(t=d,2):n<49152?(t=b,4):(t=k,8);var u=s.time-r;return 0<u&&T(u),r=99999,w&i&&(e(0),r=s.time+3),t[16383&n]},s.put=function(n,t){var i,u=w;n<32768?n<16384?(i=c,u&=17):(i=d,u&=34):n<49152?(i=b,u&=68):(i=k,u&=136);var f=s.time-r;0<f&&T(f),r=99999,u&&(15&u&&(e(0),r=s.time+3),i[n&=16383]!==t&&(i===$&&W(s.time),i[n]=t))},s.get16=function(n){var t,i,u=16383&n;if(16383==u){var f=s.get(n);return s.time+=3,f|=s.get(n+1&65535)<<8,s.time-=3,f}i=n<32768?n<16384?(t=c,1):(t=d,2):n<49152?(t=b,4):(t=k,8);var o=s.time-r;return 0<o&&T(o),r=99999,w&i&&(e(0),e(3),r=s.time+6),t[u]|t[u+1]<<8};var r,_=0,z=48,S=0;function U(n){k=p[7&(z=n)],w=8&y?226|n<<3&8:224,$=p[5|n>>2&2],c=16&n?m||h:s.rom128[0]}function e(n){(n+=s.time)<0||v<=n||(n%=l)<126&&0<(n=6-(7&n))&&(s.time+=n)}function T(n){var t,i,u=r;if(!(u+n<=0||(t=v-u)<0)){if(126<(t%=l)){if((n-=t-126)<=0)return;u=6,i=15}else{if(i=t>>3,7==(t&=7)&&(t--,!--n))return;u=t}i<(n=n-1>>1)&&(n=i),s.time+=u+6*n}}function q(n){var t=s.time-r,i=1&n;0<t&&T(t),r=8&y?n>>14^1?(i||e(1),99999):(r=s.time,T(1+i<<1),s.time+4):99999}s.inp=function(n){q(n);var t,i,u,f,o=65535,c=s.time,r=s.devs,e=r.length;for(31==(255&n)&&null!=(t=s.joy)&&(o=t),u=0;u<e;u++)(n&(f=r[u]).imask)==f.iport&&(o&=f.inp(n,c));if(o<256)return o;if(t=255,1&n){if(kn&&49152==(49154&n))t=kn.reg[kn.idx];else if(!(255&~n)&&4&y)t=S;else if(0<=c&&16&y){var a,v=c/l;c%=l,v<192&&c<124&&!(4&c)&&(a=c>>1&1|c>>2,t=$[a+=1&c?6144|v<<2&992:6144&v|v<<2&224|v<<8&1792])}}else for(t=_<<2&64|160&t|31,i=n>>8^255,u=0;i;u++)1&i&&(t&=s.keyboard[u]),i>>=1;return o&=t|o>>8^255,32770&n||32&z||(8&(z^o)&&W(c),U(o)),o},s.out=function(n,t){q(n);var i,u,f=s.time,o=s.devs,c=o.length;for(i=0;i<c;i++){var r=o[i];(n&r.omask)==r.oport&&r.out(n,t,f)}if(1&n||((u=7&t)!=nn&&(un(f),nn=u),24&(_^t)&&bn(f+(t>>1&8^8)),_=t),!(2&n))if(n<32768){if(32&z)return;8&(z^t)&&W(f),U(t)}else kn&&(n<49152?(bn(f),mn(kn.idx,t),dn(0,kn.level-(kn.level=yn()))):kn.idx=15&t);!(255&~n)&&4&y&&(W(f),J=8191&J|(1&t)<<13,S=t)},s.halt=function(n){return n};var F=4,L=28,N=8*(F+32+F),A=L+192+L;s.dim=[N,A];var C,E,O=16,R=0,I=0,J=0,M=0,D=0;function W(n){if(!(n<I)){var t,i,u=J,f=I,o=M,c=D,r=1<<(u>>5&7|u>>8&24);t=(i=3&S)<2?(-256&u)-(u>>3&768)-6144:3^i&&-8192;do{if(i=C[$[u-t]]|$[u++],E[++o]!==i&&(E[o]=i,Z(o,c,i),R|=r),i=C[$[u-t]]|$[u++],E[++o]!==i&&(E[o]=i,Z(o,c,i),R|=r),f+=8,!(31&u)){if(f+=l-128,o+=2*F,c+=G,u+=224,2&S){if(1792&u)continue;if(r<<=1,224&(u-=2016))continue}else{if(t+=256,1792&u)continue;if(t-=2048,r<<=1,224&(u-=2016))continue;t+=1792}if(6144<=(8191&(u+=1792))){f=99999;break}}}while(f<=n);J=u,I=f,M=o,D=c}}var B,H,j,X,Y,Z,G,K,P=0,Q=0,V=0,nn=0,tn=-1;function un(n){var t=P;if(!(n<t)){tn=-1;var i=Q,u=V,f=G*(u+L),o=F+(F+32+F)*L+(F+32+F)*u+i,c=C[nn<<3];do{if(E[o]!==c&&(E[o]=c,Z(o,f,c),R=-1),o++,t+=4,!++i&&0<=u&&u<192)o+=i=32,t+=128;else if(32+F<=i){if(i=-F,++u==8*(24+L)){t=99999;break}t+=l-4*(F+32+F),f+=G}}while(t<=n);Q=i,V=u,P=t}}function o(){var n,t=X,i=t*A;for(H=B.createImageData(N,i),n=(j=H.data).length-1;0<n;n-=4)j[n]=255;for(Y=[[0,11406853,198,11996364,311808,12373765,1032645,12963275,0,12065042,1316055,13708518,3008039,15268407,4781817,16777215],[0,11734533,203,12324305,313344,12702725,1099466,13292240,0,12392978,1381853,14101996,3075113,15662904,4914431,16777215,0,11144453,192,11668422,244992,12044549,965823,12568517,0,11737105,1250258,13314784,2875430,14873909,4648946,16777215]][--t],C=[],n=0;n<128;n++)C[128|n]=C[n]=(n<<1&240|n>>3&8|7&n)<<8;for(G=t*N,j=new Uint32Array(j.buffer),n=Y.length;0<=--n;)Y[n]|=-1<<24;Z=[u,f][t]}function u(n,t,i){var u,f,o=j;for(u=Y[i>>12],f=Y[i>>8&15],n*=8;o[n++]=128&i?f:u,i<<=1,7&n;);}function f(n,t,i){var u,f,o,c,r=j;for(c=i>>8&15,u=Y[f=i>>12],o=Y[c]^u,f=Y[f+16],c=Y[c+16]^f,i^=i>>1&127,t+=8*n;128&i&&(u^=o,f^=c),i<<=1,r[t]=u,r[t+N]=f,7&++t;);}function i(){H||o();var n,t,i=0,u=0;for(t=0;t<192+2*L;t++){for(n=0;n<32+2*F;n++,i++)Z(i,u,E[i]);u+=G}fn(-1)}function fn(n){var t=B,i=t.canvas,u=i.width-N>>1,f=i.height-X*A>>1;if(n<(R=0))return t.putImageData(H,u,f);var o=r(n),c=r(n^n-1);function r(n){var t=0;return 65535<n&&(n>>=t=16),255<n&&(n>>=8,t+=8),15<n&&(n>>=4,t+=4),t+(-21936>>2*n&3)}t.putImageData(H,u,f,8*F-1,X*(8*c+L)-1,258,8*X*(o-c+1)+2)}var on,cn,rn,en,an=0,vn=0,sn=0;function ln(){return 16&_?8&_?en:rn:0}function dn(n,t){if(K){var i=an*t/on,u=K.v,f=K.k,o=K.p;u[f]+=i,u[f=f+1&o]+=t-i;var c=f;for(n=an-cn*n;n<0;)n+=on,u[f=f+1&o]=0;an=n,(K.s-c&o)<=(f-c&o)&&(K.s=f+1&o),K.k=f-1&o}}function bn(n){var t,i,u,f=vn;if(u=(i=ln())-sn,sn=i,kn){for((t=pn)||(u+=$n(kn),t+=16),t+=f;t<n;)(i=$n(kn))&&(dn(t-f,u),f=t,u=i),t+=16;pn=t-n}dn(n-f,u),vn=n}s.audio=function(n){(K=n)&&(cn=n.hz)},(s.volume=function(n){rn=.93*(en=n*=n),kn&&hn(),sn=ln()})(.5);var kn,pn=0;function hn(){var n=en,t=kn.volt,i=15;for(t[i]=n;t[--i]=n*[0,14,20,29,42,62,85,137,169,265,353,450,570,687,848][i]/1e3,1<i;);for(i=8;i<11;i++)mn(i,kn.reg[i]);kn.level=yn()}function mn(n,t){switch(n){case 0:kn.aper=3840&kn.aper|t;break;case 1:kn.aper=255&kn.aper|(t&=15)<<8;break;case 2:kn.bper=3840&kn.bper|t;break;case 3:kn.bper=255&kn.bper|(t&=15)<<8;break;case 4:kn.cper=3840&kn.cper|t;break;case 5:kn.cper=255&kn.cper|(t&=15)<<8;break;case 6:kn.nper=t&=31;break;case 7:kn.mix=~(t|kn.dis);break;case 8:case 9:case 10:var i=t&=31,u=9<<n-8;t?t<16?(kn.dis&=u=~u,kn.ech&=u):(kn.dis&=~u,kn.ech|=u,i=kn.estep^kn.eattack):(kn.dis|=u,kn.ech&=~u),kn.mix=~(kn.reg[7]|kn.dis),i=kn.volt[i],n<9?kn.avol=i:9<n?kn.cvol=i:kn.bvol=i;break;case 11:kn.eper=65280&kn.eper|t;break;case 12:kn.eper=255&kn.eper|t<<8;break;case 13:(t&=15)<8&&(t=t<4?1:7),kn.ekeep=1&t?1:-1,kn.ealt=t+1&2?15:0,kn.eattack=4&t?15:0,kn.estep=15,kn.ecnt=-1,wn()}kn.reg[n]=t}function wn(){var n,t=kn.ech;t&&(n=kn.volt[kn.estep^kn.eattack],1&t&&(kn.avol=n),2&t&&(kn.bvol=n),4&t&&(kn.cvol=n))}function $n(n){var t,i=0;return--n.acnt&n.aper||(n.acnt=-1,i^=1),--n.bcnt&n.bper||(n.bcnt=-1,i^=2),--n.ccnt&n.cper||(n.ccnt=-1,i^=4),(n.div16^=1)&&(--n.ncnt&n.nper||(n.ncnt=-1,1&(t=n.noise)&&(i^=56,t^=163840),n.noise=t>>1),--n.ecnt&n.eper||(n.ecnt=-1,n.ekeep&&(n.estep||(n.eattack^=n.ealt,n.ekeep>>=1,n.estep=16),n.estep--,n.ech&&(wn(),i|=256)))),n.gen^=i,t=0,i&n.mix&&(t=n.level-(n.level=yn())),t}function yn(){var n=kn.mix&kn.gen;return(9&n?0:kn.avol)+(18&n?0:kn.bvol)+(36&n?0:kn.cvol)}s.command=function(n,t){function f(n,t){[,d,b,k][n>>14][16383&n]=255&t}function i(n,t){f(n,t),f(n+1,t>>8)}function u(n,t,i,u){for(;0<u--;)f(n++,t[i++])}t=t||0;for(var o=s.rom48k,c={i:63,border:7,rom:null,ay:"",iy:23610,im:1,iff:3,model:t},r=16384;r<22528;r++)f(r,0);for(;r<23296;r++)f(r,56);for(;r<65536;r++)f(r,0);i(23732,--r),u(r-=167,o,15880,168),i(23675,r--),f(23608,64),i(23730,r),i(23606,15360),f(r--,62),i(23613,(c.sp=r)-2),i(23631,23734),u(23734,o,5551,21),r=23754,i(23639,r++),i(23635,r),i(23627,r),f(r++,128),i(23641,r);for(var e=0;e<n.length;e++)f(r++,n.charCodeAt(e));if(i(r,32781),i(23649,r+=2),i(23651,r),i(23653,r),f(23693,56),f(23695,56),f(23624,56),i(23561,1315),f(23552,255),f(23556,255),u(23568,o,5574,14),i(23688,6177),f(23659,2),i(23656,23698),f(23611,12),c.pc=4788,t){u(23296,s.rom128[0],107,88),f(23389,207),i(23427,60396),i(23429,11244),f(23431,1);var a=p[7];a[r=11254]=a[r+2]=0,a[r+1]=192,a[11285]=20,a[14067]=20,a[15723]=5,a[(r=11279)-1]=255,a[r]=a[r+2]=56,i(c.sp,6932),i(23425,r=23539),u(r,[231,63,43,39,231,63,122,38,49,13,103,38],0,12),c.p7FFD=0,c.pc=619}f(23672,r=32768*Math.random()|0),c.r=r>>8,s.setState(c)}},function(c){var r,o,e,a,v,s,t,l,d,b,k,p,f,h,i,u,m,w,$,y,x,g,_,z,S,U,T,q,F,L;function N(){var n=168&e|e>>8&1|!a<<6,t=v,i=s>>8,u=a^t;return n|=2&i,(n|=16&(u^s^i))|4&(t=256&t?154020>>(15&(a^a>>4)):(u&(s^a))>>5)}function A(n){a=64&~n,e=n|=n<<8,v=255&(s=-129&n|(4&n)<<5)}function C(n){S=65280&S|n,U=127&n}function E(n){l=n>>8,d=255&n}function O(n){b=n>>8,k=255&n}function R(){var n;n=y,y=l,l=n,n=x,x=d,d=n,n=g,g=b,b=n,n=_,_=k,k=n,n=z,z=p,p=n}function I(){var n=i;i=o,o=n,n=u,u=e,e=n,n=m,m=a,a=n,n=w,w=v,v=n,n=$,$=s,s=n}function n(){}function J(n){c.time++,c.put(t-1&65535,n>>8),c.time+=3,c.put(t=t-2&65535,255&n),c.time+=3}function M(){var n=c.get16(t);return t=t+2&65535,c.time+=6,n}function D(n){var t=(v=o)-n;s=~n,e=384&t|40&n,a=255&t}function W(n){return e=256&e|(a=n=(v=n)+(s=1)&255),n}function B(n){return e=256&e|(a=n=(v=n)+(s=-1)&255),n}function H(n){e=256&e|(a=n),v=256|n,s=0}function j(n){e=215&e|296&n,s&=128,v=384&v|16&a,o=255&n}function X(n,t){var i=n+t;return e=128&e|i>>8&296,v&=-17,s=128&s|16&((i^n^t)>>8^a),L=n+1,c.time+=7,65535&i}function Y(){var n=c.get(r);return r=r+1&65535,c.time+=3,n}function Z(){var n=c.get16(r);return r=r+2&65535,c.time+=6,n}function G(n){v&=-17,s=128&s|16&(n>>4^a),e=256^n|128&e|40&o}function K(n){var t=L=Z();n&&(r=t)}function P(){L=r=r+(128^c.get(r))-127&65535,c.time+=8}function Q(n){var t=L=Z();n&&(J(r),r=t)}function V(){L=r=c.get16(t),t=t+2&65535,c.time+=6}function nn(){F=!0;var n=c.time_limit-c.time+3>>2;0<n&&(n=c.halt(n,S|U),U=U+n&127,c.time+=4*n)}function tn(n){var t,i,u;n:for(;;){switch(n){case 221:case 253:break;case 243:q=0;break;case 251:q=3;break;default:$n[n]();break n}if(i=n,n=c.m1(r,S|(U=U+1&127)),r=r+1&65535,c.time+=4,4&i&&(t=yn[n])){null!=(u=t(221==i?f:h))&&(221==i?f=u:h=u);break}}1&q&&0<=c.int&&c.time<c.time_limit&&un()}function un(){var n,t=c.int;U=U+1&127,q=0,F=!1,c.time+=6,T?(J(r),n=56,1<T&&(n=c.get16(65280&S|t),c.time+=6),L=r=n):$n[t]()}function fn(n){var t=c.get(r);return r=r+1&65535,c.time+=8,L=n+(128^t)-128&65535}function on(n){var t=c.get(r);return r=r+1&65535,c.time+=8,t=c.get(L=n+(128^t)-128&65535),c.time+=3,t}function cn(n,t){var i=p+n+(e>>8&1^t);L=p+1,e=i>>8,v=p>>8,s=n>>8,p=i&=65535,a=i>>8|i<<8,c.time+=7}function rn(n){e=256&e|(o=n),a=+!!n,v=s=q<<6&128,c.time++}function en(){var n=l<<8|d,t=c.inp(n);return L=n+1,H(t),c.time+=4,t}function an(n){var t=l<<8|d;L=t+1,c.out(t,n),c.time+=4}function vn(n,t){var i,u;u=c.get(i=p),p=i+n&65535,c.time+=3,c.put(i=b<<8|k,u),b=(i+=n)>>8&255,k=255&i,c.time+=5,a&&(a=1),e=384&e|8&(u+=o)|u<<4&32,--d<(u=0)&&(l=l-1&(d=255)),l|d&&(t&&(c.time+=5,L=1+(r=r-2&65535)),u=128),v=s=u}function sn(n,t){var i,u,f;f=o-(u=c.get(i=p))&255,L+=n,p=i+n&65535,c.time+=8,a=127&f|f>>7,s=~(128|u),v=127&o,--d<0&&(l=l-1&(d=255)),l|d&&(v|=128,s|=128,t&&f&&(L=1+(r=r-2&65535),c.time+=5)),e=256&e|128&f,16&(f^u^o)&&f--,e|=f<<4&32|8&f}function ln(n){var t,i,u,f,o=n>>2;t=p+o&65535,i=l<<8|d,c.time++,1&n?(u=c.get(p),c.time+=3,L=(i=i-256&65535)+o,c.out(i,u),c.time+=4,o=t):(u=c.inp(i),c.time+=4,L=i+o,i=i-256&65535,c.put(p,u),c.time+=3,o+=i),o=(255&o)+u,p=t,l=i>>=8,2&n&&i&&(c.time+=5,r=r-2&65535),f=7&o^i,e=i|(o&=256),v=128^(a=i),s=128&((f=4928640>>(15&(f^f>>4)))^i)|o>>4|(128&u)<<2}function dn(){o=a=255&(e=1+(s=~o)),v=0}function bn(){q|=q>>1,V()}function kn(){T=0}function pn(){T=1}function hn(){T=2}function mn(n,t){switch(n){case 0:t=257*t>>7;break;case 1:t=t>>1|(1+(1&t)^1)<<7;break;case 2:t=t<<1|e>>8&1;break;case 3:t=(513*t|256&e)>>1;break;case 4:t<<=1;break;case 5:t=(513*t+128^128)>>1;break;case 6:t=t<<1|1;break;case 7:t=513*t>>1}return v=256|(a=t=255&(e=t)),s=0,t}function wn(n,t){e=256&e|40&t|(t&=1<<n),v=~(a=t),s=0}this.env=c,r=S=U=T=q=0,t=f=h=p=z=65535,o=l=d=b=k=i=y=x=g=_=255,e=a=v=s=u=m=w=$=0,F=!1,this.getState=function(){var n={pc:r,a:o,f:N(),sp:t,bc:l<<8|d,de:b<<8|k,hl:p,ix:f,iy:h,bc_:y<<8|x,de_:g<<8|_,hl_:z,a_:i,r:128&S|U,i:S>>8,im:T,iff:q,halted:F};return I(),n.f_=N(),I(),n},this.setState=function(n){"pc"in n&&(r=n.pc),"a"in n&&(o=n.a),"f"in n&&A(n.f),"sp"in n&&(t=n.sp),"bc"in n&&E(n.bc),"de"in n&&O(n.de),"hl"in n&&(p=n.hl),"ix"in n&&(f=n.ix),"iy"in n&&(h=n.iy),R(),I(),"bc_"in n&&E(n.bc_),"de_"in n&&O(n.de_),"hl_"in n&&(p=n.hl_),"a_"in n&&(o=n.a_),"f_"in n&&A(n.f_),R(),I(),"r"in n&&C(n.r),"i"in n&&(S=255&S|n.i<<8),"im"in n&&(T=3&n.im),"iff"in n&&(q=n.iff),"halted"in n&&(F=!!n.halted)},this.execute=function(){if(!(c.time>=c.time_limit)){if(1&q&&0<=c.int&&un(),F)return nn();do{var n=c.m1(r,S|(U=U+1&127));r=r+1&65535,c.time+=4,$n[n]()}while(c.time<c.time_limit)}},this.nmi=function(){q&=2,F=!1,J(r),c.time+=4,r=102},this.reset=function(){F=!1,r=S=U=T=q=0};var $n=[n,function(){var n=Z();l=n>>8,d=255&n},function(){var n=l<<8|d;L=n+1&255|o<<8,c.put(n,o),c.time+=3},function(){256==++d&&(l=l+1&255,d=0),c.time+=2},function(){l=W(l)},function(){l=B(l)},function(){l=Y()},function(){j(257*o>>7)},I,function(){p=X(p,l<<8|d)},function(){var n=l<<8|d;L=n+1,o=c.get(n),c.time+=3},function(){--d<0&&(l=l-1&(d=255)),c.time+=2},function(){d=W(d)},function(){d=B(d)},function(){d=Y()},function(){j(o>>1|(1+(1&o)^1)<<7)},function(){var n,t;c.time++,t=c.get(n=r),n++,c.time+=3,(l=l-1&255)&&(c.time+=5,L=n+=(128^t)-128),r=65535&n},function(){var n=Z();b=n>>8,k=255&n},function(){var n=b<<8|k;L=n+1&255|o<<8,c.put(n,o),c.time+=3},function(){256==++k&&(b=b+1&255,k=0),c.time+=2},function(){b=W(b)},function(){b=B(b)},function(){b=Y()},function(){j(o<<1|e>>8&1)},P,function(){p=X(p,b<<8|k)},function(){var n=b<<8|k;L=n+1,o=c.get(n),c.time+=3},function(){--k<0&&(b=b-1&(k=255)),c.time+=2},function(){k=W(k)},function(){k=B(k)},function(){k=Y()},function(){j((513*o|256&e)>>1)},function(){a?P():Y()},function(){p=Z()},function(){var n=Z();c.put(n,255&p),c.time+=3,c.put(L=n+1&65535,p>>8),c.time+=3},function(){p=p+1&65535,c.time+=2},function(){p=255&p|W(p>>8)<<8},function(){p=255&p|B(p>>8)<<8},function(){p=255&p|Y()<<8},function(){var n=0;153<(o|256&e)&&(n=352),9<(15&o|16&(a^v^s^s>>8))&&(n+=6),v=256|o,512&s?(o-=n,s=~n):o+=s=n,e=(a=o&=255)|256&n},function(){a?Y():P()},function(){p=X(p,p)},function(){var n=Z();L=n+1,p=c.get16(n),c.time+=6},function(){p=p-1&65535,c.time+=2},function(){p=-256&p|W(255&p)},function(){p=-256&p|B(255&p)},function(){p=-256&p|Y()},function(){e=384&e|40&(o^=255),s|=-129,v=384&v|16&~a},function(){256&e?Y():P()},function(){t=Z()},function(){var n=Z();L=n+1&255|o<<8,c.put(n,o),c.time+=3},function(){t=t+1&65535,c.time+=2},function(){var n=W(c.get(p));c.time+=4,c.put(p,n),c.time+=3},function(){var n=B(c.get(p));c.time+=4,c.put(p,n),c.time+=3},function(){c.put(p,Y()),c.time+=3},function(){G(0)},function(){256&e?P():Y()},function(){p=X(p,t)},function(){var n=Z();L=n+1,o=c.get(n),c.time+=3},function(){t=t-1&65535,c.time+=2},function(){o=W(o)},function(){o=B(o)},function(){o=Y()},function(){G(256&e)},n,function(){l=d},function(){l=b},function(){l=k},function(){l=p>>8},function(){l=255&p},function(){l=c.get(p),c.time+=3},function(){l=o},function(){d=l},n,function(){d=b},function(){d=k},function(){d=p>>8},function(){d=255&p},function(){d=c.get(p),c.time+=3},function(){d=o},function(){b=l},function(){b=d},n,function(){b=k},function(){b=p>>8},function(){b=255&p},function(){b=c.get(p),c.time+=3},function(){b=o},function(){k=l},function(){k=d},function(){k=b},n,function(){k=p>>8},function(){k=255&p},function(){k=c.get(p),c.time+=3},function(){k=o},function(){p=255&p|l<<8},function(){p=255&p|d<<8},function(){p=255&p|b<<8},function(){p=255&p|k<<8},n,function(){p=255&p|(255&p)<<8},function(){p=255&p|c.get(p)<<8,c.time+=3},function(){p=255&p|o<<8},function(){p=-256&p|l},function(){p=-256&p|d},function(){p=-256&p|b},function(){p=-256&p|k},function(){p=-256&p|p>>8},n,function(){p=-256&p|c.get(p),c.time+=3},function(){p=-256&p|o},function(){c.put(p,l),c.time+=3},function(){c.put(p,d),c.time+=3},function(){c.put(p,b),c.time+=3},function(){c.put(p,k),c.time+=3},function(){c.put(p,p>>8),c.time+=3},function(){c.put(p,255&p),c.time+=3},nn,function(){c.put(p,o),c.time+=3},function(){o=l},function(){o=d},function(){o=b},function(){o=k},function(){o=p>>8},function(){o=255&p},function(){o=c.get(p),c.time+=3},n,function(){o=a=255&(e=(v=o)+(s=l))},function(){o=a=255&(e=(v=o)+(s=d))},function(){o=a=255&(e=(v=o)+(s=b))},function(){o=a=255&(e=(v=o)+(s=k))},function(){o=a=255&(e=(v=o)+(s=p>>8))},function(){o=a=255&(e=(v=o)+(s=255&p))},function(){o=a=255&(e=(v=o)+(s=c.get(p))),c.time+=3},function(){o=a=255&(e=2*(v=s=o))},function(){o=a=255&(e=(v=o)+(s=l)+(e>>8&1))},function(){o=a=255&(e=(v=o)+(s=d)+(e>>8&1))},function(){o=a=255&(e=(v=o)+(s=b)+(e>>8&1))},function(){o=a=255&(e=(v=o)+(s=k)+(e>>8&1))},function(){o=a=255&(e=(v=o)+(s=p>>8)+(e>>8&1))},function(){o=a=255&(e=(v=o)+(s=255&p)+(e>>8&1))},function(){o=a=255&(e=(v=o)+(s=c.get(p))+(e>>8&1)),c.time+=3},function(){o=a=255&(e=2*(v=s=o)+(e>>8&1))},function(){o=a=255&(e=(v=o)+(s=~l)+1)},function(){o=a=255&(e=(v=o)+(s=~d)+1)},function(){o=a=255&(e=(v=o)+(s=~b)+1)},function(){o=a=255&(e=(v=o)+(s=~k)+1)},function(){o=a=255&(e=(v=o)+(s=~(p>>8))+1)},function(){o=a=255&(e=(v=o)+(s=~(255&p))+1)},function(){o=a=255&(e=(v=o)+(s=~c.get(p))+1),c.time+=3},function(){s=~(v=o),o=a=e=0},function(){o=a=255&(e=(v=o)+(s=~l)+(e>>8&1^1))},function(){o=a=255&(e=(v=o)+(s=~d)+(e>>8&1^1))},function(){o=a=255&(e=(v=o)+(s=~b)+(e>>8&1^1))},function(){o=a=255&(e=(v=o)+(s=~k)+(e>>8&1^1))},function(){o=a=255&(e=(v=o)+(s=~(p>>8))+(e>>8&1^1))},function(){o=a=255&(e=(v=o)+(s=~(255&p))+(e>>8&1^1))},function(){o=a=255&(e=(v=o)+(s=~c.get(p))+(e>>8&1^1)),c.time+=3},function(){s=~(v=o),o=a=255&(e=(e>>8&1^1)-1)},function(){v=~(o=e=a=o&l),s=0},function(){v=~(o=e=a=o&d),s=0},function(){v=~(o=e=a=o&b),s=0},function(){v=~(o=e=a=o&k),s=0},function(){v=~(o=e=a=o&p>>8),s=0},function(){v=~(o=e=a=o&p&255),s=0},function(){v=~(o=e=a=o&c.get(p)),s=0,c.time+=3},function(){v=~(e=a=o),s=0},function(){v=256|(o=e=a=o^l),s=0},function(){v=256|(o=e=a=o^d),s=0},function(){v=256|(o=e=a=o^b),s=0},function(){v=256|(o=e=a=o^k),s=0},function(){v=256|(o=e=a=o^p>>8),s=0},function(){v=256|(o=e=a=o^255&p),s=0},function(){v=256|(o=e=a=o^c.get(p)),s=0,c.time+=3},function(){o=e=a=s=0,v=256},function(){v=256|(o=e=a=o|l),s=0},function(){v=256|(o=e=a=o|d),s=0},function(){v=256|(o=e=a=o|b),s=0},function(){v=256|(o=e=a=o|k),s=0},function(){v=256|(o=e=a=o|p>>8),s=0},function(){v=256|(o=e=a=o|255&p),s=0},function(){v=256|(o=e=a=o|c.get(p)),s=0,c.time+=3},function(){v=256|(e=a=o),s=0},function(){D(l)},function(){D(d)},function(){D(b)},function(){D(k)},function(){D(p>>8)},function(){D(255&p)},function(){D(c.get(p)),c.time+=3},function(){D(o)},function(){c.time++,a&&V()},function(){var n=M();l=n>>8,d=255&n},function(){K(a)},function(){L=r=Z()},function(){Q(a)},function(){J(l<<8|d)},function(){o=a=255&(e=(v=o)+(s=Y()))},function(){J(r),L=r=0},function(){c.time++,a||V()},V,function(){K(!a)},function(){var n,t,i;n=c.m1(r,S|(U=U+1&127)),r=r+1&65535,c.time+=4,t=7&(i=n>>3),i=8&i|7&n,n<128?gn[i](t):_n[i](1<<t)},function(){Q(!a)},function(){var n=Z();J(r),L=r=n},function(){o=a=255&(e=(v=o)+(s=Y())+(e>>8&1))},function(){J(r),L=r=8},function(){c.time++,256&e||V()},function(){var n=M();b=n>>8,k=255&n},function(){K(!(256&e))},function(){var n=Y()|o<<8;c.out(n,o),L=n+1&255|65280&n,c.time+=4},function(){Q(!(256&e))},function(){J(b<<8|k)},function(){o=a=255&(e=(v=o)+(s=~Y())+1)},function(){J(r),L=r=16},function(){c.time++,256&e&&V()},R,function(){K(256&e)},function(){var n=Y()|o<<8;L=n+1,o=c.inp(n),c.time+=4},function(){Q(256&e)},function(){tn(221)},function(){o=a=255&(e=(v=o)+(s=~Y())+(e>>8&1^1))},function(){J(r),L=r=24},function(){c.time++,4&N()^4&&V()},function(){p=M()},function(){K(4&N()^4)},function(){L=M(),J(p),p=L,c.time+=2},function(){Q(4&N()^4)},function(){J(p)},function(){v=~(o=e=a=o&Y()),s=0},function(){J(r),L=r=32},function(){c.time++,4&N()&&V()},function(){r=p},function(){K(4&N())},function(){var n=p;p=b<<8|k,b=n>>8,k=255&n},function(){Q(4&N())},function(){var n=xn[c.m1(r,S|(U=U+1&127))];r=r+1&65535,c.time+=4,n&&n()},function(){v=256|(o=e=a=o^Y()),s=0},function(){J(r),L=r=40},function(){c.time++,128&e||V()},function(){!function(n){A(255&n),o=n>>8}(M())},function(){K(!(128&e))},function(){tn(243)},function(){Q(!(128&e))},function(){J(o<<8|N())},function(){v=256|(o=e=a=o|Y()),s=0},function(){J(r),L=r=48},function(){c.time++,128&e&&V()},function(){t=p,c.time+=2},function(){K(128&e)},function(){tn(251)},function(){Q(128&e)},function(){tn(253)},function(){D(Y())},function(){J(r),L=r=56}],yn=[,,,,,,,,,function(n){return X(n,l<<8|d)},,,,,,,,,,,,,,,,function(n){return X(n,b<<8|k)},,,,,,,,Z,function(n){var t=Z();c.put(t,255&n),c.time+=3,c.put(L=t+1&65535,n>>8),c.time+=3},function(n){return n=n+1&65535,c.time+=2,n},function(n){return 255&n|W(n>>8)<<8},function(n){return 255&n|B(n>>8)<<8},function(n){return 255&n|Y()<<8},,,function(n){return X(n,n)},function(n){var t=Z();return L=t+1,n=c.get16(t),c.time+=6,n},function(n){return n=n-1&65535,c.time+=2,n},function(n){return-256&n|W(255&n)},function(n){return-256&n|B(255&n)},function(n){return-256&n|Y()},,,,,,function(n){var t=fn(n),i=W(c.get(t));c.time+=4,c.put(t,i),c.time+=3},function(n){var t=fn(n),i=B(c.get(t));c.time+=4,c.put(t,i),c.time+=3},function(n){var t,i=fn(n);c.time+=-5,t=Y(),c.time+=2,c.put(i,t),c.time+=3},,,function(n){return X(n,t)},,,,,,,,,,,function(n){l=n>>8},function(n){l=255&n},function(n){l=on(n)},,,,,,function(n){d=n>>8},function(n){d=255&n},function(n){d=on(n)},,,,,,function(n){b=n>>8},function(n){b=255&n},function(n){b=on(n)},,,,,,function(n){k=n>>8},function(n){k=255&n},function(n){k=on(n)},,function(n){return 255&n|l<<8},function(n){return 255&n|d<<8},function(n){return 255&n|b<<8},function(n){return 255&n|k<<8},,function(n){return 255&n|(255&n)<<8},function(n){p=255&p|on(n)<<8},function(n){return 255&n|o<<8},function(n){return-256&n|l},function(n){return-256&n|d},function(n){return-256&n|b},function(n){return-256&n|k},function(n){return-256&n|n>>8},,function(n){p=-256&p|on(n)},function(n){return-256&n|o},function(n){c.put(fn(n),l),c.time+=3},function(n){c.put(fn(n),d),c.time+=3},function(n){c.put(fn(n),b),c.time+=3},function(n){c.put(fn(n),k),c.time+=3},function(n){c.put(fn(n),p>>8),c.time+=3},function(n){c.put(fn(n),255&p),c.time+=3},,function(n){c.put(fn(n),o),c.time+=3},,,,,function(n){o=n>>8},function(n){o=255&n},function(n){o=on(n)},,,,,,function(n){o=a=255&(e=(v=o)+(s=n>>8))},function(n){o=a=255&(e=(v=o)+(s=255&n))},function(n){o=a=255&(e=(v=o)+(s=on(n)))},,,,,,function(n){o=a=255&(e=(v=o)+(s=n>>8)+(e>>8&1))},function(n){o=a=255&(e=(v=o)+(s=255&n)+(e>>8&1))},function(n){o=a=255&(e=(v=o)+(s=on(n))+(e>>8&1))},,,,,,function(n){o=a=255&(e=(v=o)+(s=~(n>>8))+1)},function(n){o=a=255&(e=(v=o)+(s=~(255&n))+1)},function(n){o=a=255&(e=(v=o)+(s=~on(n))+1)},,,,,,function(n){o=a=255&(e=(v=o)+(s=~(n>>8))+(e>>8&1^1))},function(n){o=a=255&(e=(v=o)+(s=~(255&n))+(e>>8&1^1))},function(n){o=a=255&(e=(v=o)+(s=~on(n))+(e>>8&1^1))},,,,,,function(n){v=~(o=e=a=o&n>>8),s=0},function(n){v=~(o=e=a=o&n&255),s=0},function(n){v=~(o=e=a=o&on(n)),s=0},,,,,,function(n){v=256|(o=e=a=o^n>>8),s=0},function(n){v=256|(o=e=a=o^255&n),s=0},function(n){v=256|(o=e=a=o^on(n)),s=0},,,,,,function(n){v=256|(o=e=a=o|n>>8),s=0},function(n){v=256|(o=e=a=o|255&n),s=0},function(n){v=256|(o=e=a=o|on(n)),s=0},,,,,,function(n){D(n>>8)},function(n){D(255&n)},function(n){D(on(n))},,,,,,,,,,,,,function(n){var t,i,u,f;switch(t=L=n+(128^c.get(r))-128&65535,c.time+=3,i=c.get(r+1&65535),r=r+2&65535,c.time+=5,u=c.get(t),c.time+=4,f=i>>3&7,192&i){case 0:u=mn(f,u);break;case 64:return wn(f,u),void(e=384&e|t>>8&40);case 128:u&=~(1<<f);break;case 192:u|=1<<f}switch(c.put(t,u),c.time+=3,7&i){case 0:l=u;break;case 1:d=u;break;case 2:b=u;break;case 3:k=u;break;case 4:p=255&p|u<<8;break;case 5:p=65280&p|u;break;case 7:o=u}},,,,,,,,,,,,,,,,,,,,,,M,,function(n){return L=M(),J(n),c.time+=2,L},,J,,,,function(n){r=n},,,,,,,,,,,,,,,,function(n){t=n,c.time+=2}],xn=[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(){l=en()},function(){an(l)},function(){cn(~(l<<8|d),1)},function(){var n=Z();c.put(n,d),c.time+=3,c.put(L=n+1&65535,l),c.time+=3},dn,bn,kn,function(){S=255&S|o<<8,c.time++},function(){d=en()},function(){an(d)},function(){cn(l<<8|d,0)},function(){var n=Z();L=n+1,n=c.get16(n),l=n>>8,d=255&n,c.time+=6},dn,bn,kn,function(){C(o),c.time++},function(){b=en()},function(){an(b)},function(){cn(~(b<<8|k),1)},function(){var n=Z();c.put(n,k),c.time+=3,c.put(L=n+1&65535,b),c.time+=3},dn,bn,pn,function(){rn(S>>8)},function(){k=en()},function(){an(k)},function(){cn(b<<8|k,0)},function(){var n=Z();L=n+1,n=c.get16(n),b=n>>8,k=255&n,c.time+=6},dn,bn,hn,function(){rn(128&S|U)},function(){p=255&p|en()<<8},function(){an(p>>8)},function(){cn(~p,1)},function(){var n=Z();c.put(n,255&p),c.time+=3,c.put(L=n+1&65535,p>>8),c.time+=3},dn,bn,kn,function(){var n=c.get(p)|o<<8;c.time+=7,H(o=240&o|15&n),c.put(p,n>>4&255),L=p+1,c.time+=3},function(){p=-256&p|en()},function(){an(255&p)},function(){cn(p,0)},function(){var n=Z();L=n+1,p=c.get16(n),c.time+=6},dn,bn,kn,function(){var n=c.get(p)<<4|15&o;c.time+=7,H(o=240&o|n>>8),c.put(p,255&n),L=p+1,c.time+=3},en,function(){an(0)},function(){cn(~t,1)},function(){var n=Z();c.put(n,255&t),c.time+=3,c.put(L=n+1&65535,t>>8),c.time+=3},dn,bn,pn,,function(){o=en()},function(){an(o)},function(){cn(t,0)},function(){var n=Z();L=n+1,t=c.get16(n),c.time+=6},dn,bn,hn,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(){vn(1,0)},function(){sn(1,0)},function(){ln(4)},function(){ln(5)},,,,,function(){vn(-1,0)},function(){sn(-1,0)},function(){ln(-4)},function(){ln(-3)},,,,,function(){vn(1,1)},function(){sn(1,1)},function(){ln(6)},function(){ln(7)},,,,,function(){vn(-1,1)},function(){sn(-1,1)},function(){ln(-2)},function(){ln(-1)}],gn=[function(n){l=mn(n,l)},function(n){d=mn(n,d)},function(n){b=mn(n,b)},function(n){k=mn(n,k)},function(n){p=255&p|mn(n,p>>8)<<8},function(n){p=-256&p|mn(n,255&p)},function(n){var t=mn(n,c.get(p));c.time+=4,c.put(p,t),c.time+=3},function(n){o=mn(n,o)},function(n){wn(n,l)},function(n){wn(n,d)},function(n){wn(n,b)},function(n){wn(n,k)},function(n){wn(n,p>>8)},function(n){wn(n,255&p)},function(n){wn(n,c.get(p)),e=384&e|L>>8&40,c.time+=4},function(n){wn(n,o)}],_n=[function(n){l&=~n},function(n){d&=~n},function(n){b&=~n},function(n){k&=~n},function(n){p&=~(n<<8)},function(n){p&=~n},function(n){var t=c.get(p)&~n;c.time+=4,c.put(p,t),c.time+=3},function(n){o&=~n},function(n){l|=n},function(n){d|=n},function(n){b|=n},function(n){k|=n},function(n){p|=n<<8},function(n){p|=n},function(n){var t=c.get(p)|n;c.time+=4,c.put(p,t),c.time+=3},function(n){o|=n}]})}();
