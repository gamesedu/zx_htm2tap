// Qaop/JS Copyright by Jan Bobrowski 2011-2020
function script(r,n){var e=$("head"),a=e.appendChild($e("script"));a.onload=()=>{e.removeChild(a),n&&n()},a.src=r}function request(o,t,r){var n,u=!(t=t||{}).nopb;if(o.data)return o.eof=1,c();if(n=o.file){o.type||(o.type=n.type),o.name||(o.name=n.name);var e=new FileReader;return(f=e.readAsArrayBuffer)?f.call(e,n):e.readAsBinaryString(n),void(e.onloadend=()=>{o.data=e.result,f&&(o.data=new Uint8Array(o.data)),o.eof=1,c()})}var f={};function a(){var r={};t.acc&&(r.headers={Accept:t.acc}),fetch(o.url,r).then(r=>{if(o.type=o.type||r.headers.get("Content-Type"),r.status&&200!=r.status)return v(r.statusText);o.url=r.url;var e=+r.headers.get("Content-Length");if(f.t=e,f.b=0,t.text)r.text().then(r=>{o.data=r,s(r.length)});else{if(r.body){var n=r.body.getReader();return a()}r.arrayBuffer().then(r=>{r=new Uint8Array(r),o.data=r,s(r.length)})}function a(){return n.read().then(i)}function i(r){var n=r.done,r=r.value;if(r&&(f.b+=r.length,function(r){var n,e,a,i,t;n=o.data,a=o.pos,n&&(e=n.length,i=e-a)&&((t=new Uint8Array(i+r.length)).set(n.subarray(a,e)),t.set(r,i),r=t);o.data=r,o.pos=0}(r),u&&(f.t=f.b<e?e:f.b+9999,ui.progress(f))),!n)return c(),a();s(f.b)}}).catch(r=>v(r))}function c(){r&&r(o)}function s(r,n){o.eof=f.e=1,f.t=f.b=r,u&&ui.progress(f),n&&(o.data=null,ui.msg(n)),c()}function v(r){s(1,r||"Error")}this.fetch?a():script("qaop/fetch.js",a)}!function(){function n(a){var r,i=[];if(!function(r){for(var n in r){var e=r[n];i[e]=255&a[n],n.match(/.[a-z]/)&&(i[e+1]=a[n]>>8)}}({a:0,f:1,bc:2,hl:4,pc:32,sp:8,i:10,r:11,de:13,bc_:15,de_:17,hl_:19,a_:21,f_:22,iy:23,ix:25}),i[12]=a.r>>7&1|a.border<<1|32,r=a.iff,i[27]=1&r,i[28]=2&r&&(a.halted?118:1),i[29]=80|a.im,r=a.model,i[34]=r?5==r?9:3:a.tc2048|a.pFF?14:0,i[35]=a.p7FFD,i[36]=0|a.pFF,r=3,a.ay){for(i[38]=a.ay.idx,r=0;r<16;r++)i[39+r]=a.ay.reg[r];r=7}i[37]=r,i.length=32+(i[30]=23);var f=String.fromCharCode,c=f.apply(0,i);if(a.model){var n,e=5|a.p7FFD>>2&2;for(t(3+e,e),n=0;n<8;n++)n!=e&&t(n+3,n)}else t(8,5),t(4,2),t(5,0);return(i=a.rom)&&o(1,i,0),c;function t(r,n){o(r,a.ram[n],0)}function o(r,n,e){var a,i,t,o=e+16384,u="";do{for(a=n[e],i=1;n[++e]===a&&i<255;)i++;if(t=f(a),4<i||237==a&&1<i)u+="\xed\xed"+f(i)+t;else{for(;u+=t,--i;);237==a&&e<o&&(u+=f(n[e++]))}}while(e<o);i=u.length,c+=f(255&i,i>>8,r)+u}}function kr(r,n,e){var a,i,t=((t=null==(t=r.className)?(r=$(r)).className:t)+"").split(" ");for(e="+-"[+(null!=e&&!e)];i=(n=n.match(/([-+])?(\S+)\s*(.*)/))[1]||e,(a=t.indexOf(n[2]))<0?"-"==i||t.push(n[2]):"+"==i||t.splice(a,1),n=n[3];);return r.className=t.join(" "),r}function hr(r,n){return r.matches&&r.matches(n)}function mr(r){var n=document,e=n.activeElement,a=r.scrollIntoViewIfNeeded;if(a)return a.call(r);e==r?e.blur():(r.focus(),n.activeElement!=r&&(r.tabIndex=-1,r.focus(),delete r.tabIndex,r.removeAttribute("tabindex"))),e.focus()}emu=(()=>{var v,h,$={speed:1},a=["load"];$.init=(r,n,e)=>{$.zx=h=new n(e),h.rom48k=r.shift(),h.rom128=r,h.init();try{!function(r){var n=this.AudioContext||this.webkitAudioContext;if(!n)throw"No audio";var e=new n,a=e.createScriptProcessor(2048,0,1);a.connect(e.destination);n={hz:e.sampleRate,v:new Float32Array(8192),p:0,k:0,h:8191};a.onaudioprocess=function(v){var l=0,b=0,r=v.hz,d=Math.pow(2,-35e5/(700*r)),p=Math.pow(2,-35e5/(23256*r));return r=>{emu.m=void 0;var n,e=r.outputBuffer.getChannelData(0),a=v.v,i=v.p,t=v.h,o=e.length,r=v.k-i&t,u=o<r?o:r,f=l,c=b,s=0;if(0<u)for(;n=f+a[i],i=i+1&t,e[s++]=c=p*(c+n-(f=d*n)),--u;);if(v.p=i,0<(u=o-r)&&(c||f))for(;e[s++]=c=p*(c+(n=f)-(f*=d)),--u;);b=c,l=f}}(n),console.log(a),r(n),emu.m=()=>{emu.m=void 0,e.resume()}}(h.audio),$.$=1}catch(r){ui.msg(r)}};var l,i,w,b=[],d=[,,,18247,,,,,17476,20303,,,,1542,,,0,3855,3855,,,,,,,,,17219,,,,,1799,,,,17219,25443,23644,21588,25700,,,,,,,,1028,771,2827,4883,6939,8995,9252,7196,5140,3084,,34957,,38542,,,,257,10023,6168,4369,4626,6425,8481,9766,5397,7710,5654,3598,5911,7967,3341,1285,514,6682,2313,8738,7453,8224,2570,4112,9509,2056,0,3855,,,,,,,,,,,,,,42919,38550,,40606,,41120,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,33950,,,,,,,,,,,,,34957,38542,39583,33950,41623,39072,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34204];function t(r){if(r=r?0:2,w)h.frame(r),e();else{for(var n=$.speed;n--;)l&&l(),h.frame(n?1:5|r);$.tape&&e()}}function e(){var n,r,e,a=w;if(!(1&(i=h.cpu.getState()).iff||(r=i.pc)<1387||1540<r)){var i=h.getState(2),t=[h.rom48k,i.ram[5],i.ram[2],i.ram[7&i.p7FFD]];if(a)n=a.pos,e=a.data.length;else{if(!(16&i.p7FFD))return;if((r=1507<=r&&1510==(r=p())?p():r)<1387||1403<=r)return;if(a=$.tape,e=a.data.length,a.blk|=0,a.eof&&a.blk>=e&&(a.blk=0),(n=a.blk+2)<=e)a.blk=n+(d(n-2)|d(n-1)<<8);else if(!a.eof)return;w=a,i.a=i.a_,i.f=i.f_,i.pc=r,i.hl&=255}for(var o,u,f=255&i.hl,c=i.hl>>8&255,s=i.ix,v=i.a,l=i.f;;){if(n==a.blk)return b(80),0;if(e<=n){if(a.eof)return b(80),0;break}if(f=d(n++),c^=f,!i.de)return b((v=c)<1|v-1&128|!(v-1)<<6|!(15&v)<<4|2),0;if(64&l){if(1&l)o=s,u=f,16383<(o&=65535)&&(t[o>>14][16383&o]=u);else if(v=k(s)^f)return b(0),0;s=s+1&65535,i.de--}else{if(v^=f)return b(0),0;l|=64}}return b(-1),0}function b(r){i.ix=s,i.hl=c<<8|f,i.a=v,0<=r&&(l=r,i.pc=p(),w=null,(r=$.next_tape)&&a.eof&&n==e&&($.tape=r)),i.f=l,h.setState(i),a.pos=n}function d(r){var n=a.data;return 255&(n.charCodeAt?n.charCodeAt(r):n[r])}function p(){var r=i.sp;return i.sp=r+2&65535,k(r)|k(r+1&65535)<<8}function k(r){return t[r>>14][16383&r]}w=null}$.kbd=(r,n,e)=>{if(r==v||r===+r){for(var a=0;a<8;a++)h.keyboard[a]=255;r==(l=v)?b=[]:function(r,n,e){var a,i,t=h.keyboard;r:{for(a=0;a<b.length;a++)if(r==b[a]){n||b.splice(a,1);break r}n&&b.push(r)}for(a=0;a<b.length;a++){if((i=b[a])<0){if((i=d[~i])==v)continue;switch(1&e&&(i>>=8),(i&=255)>>6){case 1:t[0]&=254,t[7]|=2;break;case 2:t[7]&=253,t[0]|=1}}t[7&i]&=~(1<<(i>>3&7))}}(r,n,e)}else i=r,c=f=u=0,s=h.keyboard,l=()=>{if(!u){if(f==i.length)return void(l=null);if(!(o=1+"aq10p\n zsw29ol xde38ikmcfr47ujnvgt56yhb AQ  P  ZSW  OL XDE  IKMCFR  UJNVGT  YHB   !_\"  :  @);= \xa3  #( +.? <$' -,/ >%& ^* ~   \xa9   |       \\       {   ]   }   [".indexOf(i[f++])))return;3==(o=(o-(t=o%40))/40)&&(c^o?(f--,t=0):o--),c=o,s[0]=254|1&c^1,s[7]=253|2&c^2,s[7&t]&=~(1<<(t>>3)),u=5}3==--u&&(s[7&t]|=1<<(t>>3))};var i,t,o,u,f,c,s},$.stop=(r,n)=>{var e=a.indexOf(r);if(n)e<0&&a.push(r);else{if(n==v)return 0<=e;e<0||(a.splice(e,1),a.length||function n(e){requestAnimationFrame(r=>{if(!a.length){if(r<e)return n(e);r<e+20?r=e:r<e+40&&(t(1),r=e+20),t(),n(r+20)}})}())}},$.canvas=(r,n)=>{var e=h.dim,n=1+(n>=2*e[1]);n!=i&&(i=n,r.width=e[0],r.height=n*e[1]),h.canvas(r,n)},$.reset=()=>{h.setState({rom:null,ay:""}),h.reset()};var o={};function p(r,n,e){if(e&&o[r]&&o[r].abort(),o[r]=n)switch(r){case"tape":w=null;break;case"snap":$.stop(r,0)}}function k(r,n){var e;if(r=r.toLowerCase(),n)r=(e=r.match(/\S\.(\w{3})$/))&&e[1];else if(3<r.length&&(r=(e=r.match(/^(application|image)\/(x\.zx\.|x-spectrum-)([-.a-z0-9]+)/))&&e[3])&&"i"==e[1][0]&&"scr"!=r)return;if((r="slt"==r?"z80":r)&&~["rom","sna","z80","tap","scr"].indexOf(r))return r}function y(r){return 1-/^48k?$|^0$/i.test(r)}return $.load=(e,r,a)=>{var i,t,o,u,f;function c(){$.tape={data:r.data,pos:0},o=()=>$.tape.data=r.data,u=()=>$.tape.eof=1}function s(r){ui.progress({tap:"#0C3",rom:"#D04"}[r]||"#06F")}"string"==typeof r?r={url:r}:window.File&&r instanceof File&&(r={file:r}),"tape"==e&&c(),f=request(r,{},r=>{if(!o){if(r.type&&s(i=k(r.type)),!r.data)return p(e);if(i||s(i=k(r.name||r.url,1)),"rom"==i||"sna"==i||"z80"==i||"scr"==i)s(i),$.stop("snap",1),t={ram:(t=h.getState(2)).ram},o=function(f,a,r){a.pos|=0;var c=[],e={sna:[function(){v(),d({bc:13,de:11,hl:9,ix:17,iy:15,bc_:5,de_:3,hl_:1,a:22,f:21,a_:8,f_:7,sp:23,i:0,r:20}),f.im=c[25],f.iff=4&c[19]?3:0,f.border=7&c[26],64&c[26]&&(f.ay=!0);return[i(5),i(2),i(0),l,n]},s(c,0,27)],z80:[function(){v(),d({a:0,f:1,bc:2,hl:4,pc:6,sp:8,i:10,de:13,bc_:15,de_:17,hl_:19,a_:21,f_:22,iy:23,ix:25});var r=c[12],n=c[28];255==r&&(r=1);f.r=127&c[11]|r<<7&128,f.border=r>>1&7,f.halted=118==n,f.im=3&c[29],f.iff=!!c[27]|!!n<<1,c[29]>>6==1&&(f.joy=!0);if(!f.pc)return[s(c,30,32),u];{var e;32&r&&(e=p())}return f.ram=bytes(49152),[(e||s)(f.ram,0,49152)]},s(c,0,30)],rom:[function r(n){var e=c.length;if(0<n){for(var a=n;a--;)c.push(h());return[l,r]}for(;e&e-1;)e=c.push(255);for(;e<16384;)c=c.concat(c),e+=e;v();f.rom=c,f.pc=f.im=f.iff=0},l],scr:[function r(n){v();var e,a,i,t;e=f.ram[5];for(i=6912;i<16380;i++)e[i]=0;e[i++]=243,e[i++]=118,e[i++]=24,e[i]=252;f.pc=32764;f.halted=1,f.iff=f.border=f.model=0;if(0<n){var n=c.length;if(n){for(f.pFF=2,t=8192,i=0;i<768;i++)e[t++]=e[6144+i];e[t++]=c[0],o=[s(e,t,14335)]}else{c[0]=h();var o=[l,r]}return o}t=c[0];if(!(0<=t))for(a=[0,0,0,0,0,0,0,0],i=6911,u(63,-1),u(22,-32),u(31,1),u(22,32),i=t=0;i<8;i++)a[i]>a[t]&&(t=i);f.border=7&t;return[];function u(r,n){for(;a[e[i]>>3&7]++,i+=n,--r;);}},l,s(f.ram[5],0,6912)]}[r];if(!e)throw"Unknown format";function i(r,n){return(n=n||s)(r!=+r?r:f.ram[r],0,16384)}function s(r,n,e){return()=>{for(;r[n]=h(),++n<e;);return[]}}function v(){f.model=f.pFF=f.halted=0,f.p7FFD=48,f.rom=null,f.ay=!1}function l(r){if(r)return[]}function n(r){if(0<r)return[s(c=[],0,4),t];r=f.sp;return f.pc=n(r)|n(r+1)<<8,f.sp=r+2&65535,[];function n(r){return[[],f.ram[5],f.ram[2],f.ram[0]][r>>14][16383&r]}}function t(){d({pc:0}),f.model=1,f.p7FFD=n=c[2],(n&=7)&&(c=f.ram[0],f.ram[0]=f.ram[n],f.ram[n]=c);for(var r=[],n=0;n<8;n++)2!=n&&5!=n&&n!=(7&f.p7FFD)&&r.push(i(n));return r}function u(){var r,n,e,a=c[30]|c[31]<<8,i=32+a;if(c.length<i)return[s(c,32,i),u];if(d({pc:32}),r=0,(a<24?2:3)<(i=c[34])&&i<14&&(f.p7FFD=c[35],r=9==i?5:1),f.model=r,(f.tc2048=14==(-2&i))&&(f.pFF=c[36]),1&(i=c[37])||(f.r=128&f.r|128*Math.random()),4&i)for(f.ay={idx:c[38],reg:e=[]},n=0;n<16;n++)e[n]=c[n+39];r:if(73<=a&&c[29]>>6==2){for(e=[],n=0;n<10;n+=2){var t=c[63+n],o=c[64+n];if(7<t||31<o||!o||o-1&o)break r;e.push(t|(o=o<8?o>>1:16+o>>3)<<3)}f.joy=e}return[l,b]}function b(r){if(0<r)return[s(c=[],0,3),o]}function o(){var r,n,e=c[0]|c[1]<<8,a=c[2];if(e|a)return(n=[[,2,0,,,5],[0,1,2,3,4,5,6,7]][0<f.model|0][a-3])!=+n&&(n=bytes(16384),a<2&&(f.rom=n)),[i(n,r=e<65535?p():r),b]}function d(r){for(var n in r){var e=r[n];f[n]=c[e],n.match(/.[a-z]/)&&(f[n]|=c[e+1]<<8)}}function p(){var i,t=0;return(n,e,a)=>()=>{r:for(;;)switch(t){case 0:do{if(i=h(),n[e]=i,++e==a)break r}while(237!=i);t--;case-1:if(237!=(i=h())){if(n[e]=i,++e===a)break r;t=0;break}t--,e--;case-2:if(!(i=h())){t=n.length-e;break}t--;case-3:var r=h();if(t=i,i=r,!t)break;default:do{if(n[e]=i,--t,++e===a)break r}while(t)}return[]}}var k=[];function h(){var r=a.data,n=a.data.length,e=a.pos;if(n<=e)throw k;return a.pos=e+1,r.charCodeAt?255&r.charCodeAt(e):r[e]}return()=>{try{for(var r;r=e.pop();){var n=r(a.data.length-a.pos||0-!!a.eof);if(!n)break;e=e.concat(n.reverse())}}catch(r){if(r!==k)throw r;if(a.eof)throw"Unexpected end of file"}if(r)return e.push(r)}}(t,r,i),u=()=>setTimeout(()=>$.stop("snap",0),200);else{if("tap"!=i)throw"Unknown file type";"snap"==e&&(p(e="tape",f,1),i=(i=(i=(i=r.type)&&i.match(/; *model *= *([^ ]+)/))&&y(i[1]))||h.getState().model,h.command('\xef""',i),p("snap"),c())}}if(o)try{var n=1;r.data&&o(),n=r.eof}finally{n&&(p(e),u&&u()),t&&(h.setState(t),a&&a(t))}}),p(e,f,1)},$.getType=k,$.setModel=r=>(m=y(r),null!=m&&(m={model:m},h.setState(m)),m),$})(),function(p,k,c,f){var s,u=f.body,l=p.embed,b=$("#s"),d={e:$("#l"),w:256},h={e:$("#r"),w:272},m=setTimeout,w=location,y="application/json";function x(r){top.postMessage(r,"*")}var g,a,_,o,z,S=!(p.init=()=>{var r,n;(onresize=N)(),onclick=C,onmousemove=onmouseout=onmouseup=ondragenter=ondragover=ondragleave=E,onmousedown=A,u.ontouchstart=u.ontouchmove=u.ontouchend=B,onkeydown=onkeyup=O,addEventListener("focus",R,1),addEventListener("blur",R,1),$("#c").oncopy=ondragstart=ondrag=ondragend=J,f.onpaste=ondrop=I,l||(s=localStorage,(r=function(){try{var r,n,e,a,i,t="qaop-state";if(r=s[t])for(s.removeItem(t),(i=JSON.parse(r.substr(1<<17))).ram=[],n=0;n<8;n++)for(i.ram[n]=a=bytes(16384),e=0;e<16384;e++)a[e]=r.charCodeAt(n<<14|e)}catch(r){p.msg(r)}return onunload=()=>{var r=k.zx.getState(),n=r.ram;r.pause=k.stop("user"),r.volume=T,r.mute=U,r.speed=k.speed,delete r.ram,s[t]=n.reduce((r,n)=>r+function(r){return String.fromCharCode.apply(String,r)}(n),"")+JSON.stringify(r)},i}())||m(()=>p.msg("F9 - menu",5e3),300)),(n=Y(l)||{})["!"]&&(r={iff:0,halted:1,volume:r&&r.volume});var e=0;l||(r&&(k.stop("user")^r.pause&&p.cmd("pause"),L(r)),tr($(".tabv>:last-child")),e=n.snaps<<1|!!n.u<<1|n.menu,p.show(3,3)),onhashchange=()=>Z(Y()),m(()=>{r||(n.reset=1),Z(n),k.stop("load",0)}),m(()=>p.show(3,e)),(n.snaps||n.menu)&&G(/./);var a="files"in $("input[type=file]"),i=k.$;kr(u,i?"+audio":"+noaudio"),$$(".c-pause,.c-reset,.c-128,.c-ay,.c-remember,.c-save"+(a?",.c-open":"")+(i?",#vol,.c-mute":"")).forEach(r=>r.disabled=0),b.ondblclick=()=>p.cmd("pause"),b.draggable=!0,l||((onstorage=Q)(),rr()),u.removeChild($("#splash"));var t,i=c.applicationCache;i&&(t=i,$("h1").onclick=()=>p.cmd("update"),t.onupdateready=()=>{H=1,t.swapCache(),kr(u,"+update")}),onmessage=r=>{var n,e,a=r.data;if(a===a+""?(r=a.match(/^([^ ]+) ([^ ]+)/))?(n=r[1],e=r[2]):n=a:n=a.cmd,n)switch(n){case"load":(e||a)&&p.load(e||a);break;case"model":e&&F(k.setModel(e));break;case"keydn":case"keyup":e&&k.kbd(+e,"keydn"==n);break;default:e&&p.cmd(n,e)}else L(a)},x({volume:T})}),U=!1,T=.5;function q(r,n){$$(r).forEach(r=>{kr(r,"active",n),r.checked=n})}function F(r){var n,e,a,i,t=X,o={pause:S,mute:U,volume:T};q(".c-mute",U),kr(u,"mute",U),$("#vol>*>*").style.width=100*T+"%",q(".c-pause",S),kr(u,"pause",S),(n=r.model)!=e&&(q(".c-128",n=!!n),t[128]=(o[128]=n)||e),a=r.ay,i=n,(n=null==a?i:a)!=e&&(q(".c-ay",n=!!n),t.ay=(o.ay=n)||e),(n=r.tc2048)!=e&&(t.tc2048=(o.tc2048=n=!!n)||e),l&&x(o)}function L(r){var n,e,a;k.zx.setState(r),(n=r.volume)!=a&&(T=0<n?1<n?1:n:0,e=1),(n=r.mute)!=a&&(U=!!n,e=1),e&&k.zx.volume(U?0:T),(n=r.speed)!=a&&(k.speed=1<n?0|n:1),F(r)}function N(){var r,n,e,a,i,t=3&g,o=k.zx.dim,u=innerWidth,f=innerHeight,c=u,s=f,v=0,l=512-u;switch(0<l&&(u+=l>>3),t&&(u=15*u>>4,v=f>>5,e=s-(f=15*f>>4)>>2),l=o[0]*f,(r=o[1]*u)<l?f-=f-r/o[0]|0:u-=u-l/o[1]|0,n=c-u>>1,a=d.w,i=h.w,r=c-48,t){case 1:n<(l=(a=r<a?r:a)+e)&&(n=l);break;case 2:(l=c-u-(i=r<i?r:i)-e)<n&&(n=l);break;case 3:(r>>=1)<a&&(a=r),r<i&&(i=r)}o=$("#c").style;o.width=u+"px",o.height=f+"px",o.left=n+"px",o.top=v+"px",(o=d.e.style).left=(1&t?0:-d.w)+"px",o.width=a+"px",(o=h.e.style).right=(2&t?0:-h.w)+"px",o.width=i+"px",k.canvas(b,f),l=s-f,M=!t&&127<l?f:0,(o=$("#k").style).height=l+"px",o.display=M?"block":"none",M&&D(c,l,f)}function A(r){if(a=f.activeElement,$("#vol").contains(r.target))return ir(r)}function C(r){var n=r.target,e=n.className;if(e&&e.match&&(e=e.match(/\bc-(\S+)/)))n.disabled||p.cmd(e[1]);else if(hr(n,"#s,button"))(n="s"==n.id?$("#c"):n).focus();else{if($("#vol").contains(n))return ir(r);n=f.activeElement,br(r,a!=n&&"click+focus"),a=n}}function E(e){var r=e.type,n=[e.pageX,e.pageY];if("mouseout"!=r){if(_)return _(e,r,n);var a,i,t=o;return(o=n,"m"!=r[0]&&(a=I(e)),!t||(i=n[0]-t[0])||n[1]-t[1])?(kr(u,"+move"),clearTimeout(z),z=m(()=>{if(kr(u,"-move"),t){var r,n=e.target;if(hr(n,".tabv>button"))return n.focus();br(e,"hover")||(r=t[1])<32||innerHeight-r<33||M&&M<=r||(r=t[0],i<=0&&r<32&&p.show(1,1),0<=i&&innerWidth-r<33&&p.show(2,2))}},200),a):a}null===e.relatedTarget&&clearTimeout(z)}function O(r){var n,e=r.target,a=r.keyCode,i=r.type,t="d"==i[3],o=r.ctrlKey,u=k.stop("user");if(45==a&&(n=$("[rel=search]"))&&n.click(),118==a&&t&&k.zx.bw(),119==a){var f,c=$("#kh");return c.children[0]||((f=new Image).src="qaop/keyboard.svg",c.appendChild(f)),c.style.display=t?"block":"none",void k.stop("kh",t)}r:if(!g&&(a<112||123<a)&&19!=a&&46!=a){if((27==a||32==a)&&t&&u)p.cmd("pause");else if(32<a&&a<35)ir(r);else{if(u)break r;"keypress"!=i&&k.kbd(~a,t,r.shiftKey+2*(o|r.altKey|r.metaKey))}return dr(r)}if((n={19:"pause",112:"help",113:"remember",114:"restore",116:"update",121:"mute"}[a])&&dr(r),t)if(n)p.cmd(n);else{if(o)return n={46:"reset",79:"open",83:"save"}[a],46==a&&k.kbd(),p.cmd(n),dr(r);if(27!=a&&120!=a||p.show(3,27==a?0:3^g&&3),"vol"!=e.id||a-38&-3||ir(r),"BUTTON"==e.nodeName)if(37==a||39==a){for(n=37==a?"previous":"next";(e=e[n+"ElementSibling"])&&e.hidden;);e&&"BUTTON"==e.nodeName&&e.focus()}else 40==a&&(n=e.dataset.down)&&$("#"+n).focus();br(r)}}function R(r){var n=r.target;if(n!=c){r="focus"==r.type;if("c"==n.id)return r?void p.show(3,0):(k.kbd(),void m(()=>{f.activeElement==n||g||p.show(3,3)}));r&&(hr(n,"#l *")&&p.show(1,1),hr(n,"#r *")&&p.show(2,2),hr(n,".tabv>button")&&tr(n))}}function I(r){var n=r.type,e=r.dataTransfer||r.clipboardData;if(e.dropEffect="copy",dr(r),"drop"!=n&&"paste"!=n)return!1;(n=e.files)&&(n=n[0])||(n=e.getData("URL"))?p.load(n):(n=e.getData("Text"))&&k.kbd(n)}function J(r){var n,e=r.type,a=r.dataTransfer||r.clipboardData,i=r.target;return i!=b&&"c"!=i.id?br(r):("dragstart"!=e&&"copy"!=e||(ar(a),n=$e("canvas"),i=$e("img"),r=k.zx.dim,n.height=e=r[1]>>1,n.width=r=r[0]>>1,n.getContext("2d").drawImage(b,0,0,b.width,b.height,0,0,r,e),i.src=n.toDataURL(),a.setDragImage(i,r/2,e/2)),!0)}p.cmd=(r,n)=>{var e,a,i,t=null==n;switch(r){case"pause":t&&(n=!k.stop("user")),S=!!n,k.stop("user",n),F({}),P(),n&&k.kbd();break;case"reset":k.reset(),G();break;case"open":var o=$("#open");o.onchange=()=>{var r=o.files[0];r&&p.load(r),o.value=""},o.click();break;case"save":try{/\.z80$/i.test(n=n||"snapshot")||(n+=".z80"),V(n,er())}catch(r){p.msg(r)}break;case"128":L({model:+(n=t?!k.zx.getState().model:n)});break;case"ay":L({ay:+(n=t?!k.zx.getState().ay:n)});break;case"mute":L({mute:+(n=t?!U:n)});break;case"bw":k.zx.bw(n);break;case"remember":!function(){var r,n,e,a=new Date,i=[a.getMonth()+1,a.getDate(),a.getHours(),a.getMinutes()].reduce((r,n,e)=>r+"-- :"[e]+("0"+n).substr(-2),a.getFullYear()),t=fr.snaps;for(e=0,r=i;!((n=t.o.indexOf(r))<0||n==t.sel);r=i+" ("+ ++e+")");n=t.sel;try{0<=n&&s.removeItem("zx/"+t.o[n]),s["zx/"+r]=er()}catch(r){return p.msg(r)}n<0?kr(t.e[n=vr(t,r,r)],"+sel"):t.e[n].firstChild.textContent=t.o[n]=r;t.act("sel",t.sel=n),rr()}();break;case"restore":f().act("click",i.sel);break;case"rmsna":f().act("del",i.sel);break;case"svsna":s&&(e=f().o[i.sel],(a=s["zx/"+e]).match(/^data:/)&&V(e+".z80",a));break;case"update":var u=c.applicationCache;if(u&&!H)switch(u.status){case 1:u.update();case 2:case 3:return}G(/./),w.reload();break;case"help":$("[rel=help]").click()}function f(){return i=fr.snaps}},p.load=(r,n)=>{n||G(),k.load("snap",r,F)},p.show=(r,n)=>{l&&(n&=-4);n^=g&~r;return n==g||(3&(g^n)&&kr(u,"anim",null!=g),kr(u,"full",!(3&n)),g=n,N(),$("#c")[3&n?"blur":"focus"]()),n};var M,i,D,W=[];function B(r){W=[].map.call(r.touches,r=>[r.pageX,r.pageY]),i();var n=r.type[5];"m"==n&&dr(r),"e"==n&&k.m&&k.m()}!function(){var a;$("#k").onmousedown=r=>{W[0]||(a=[r.pageX,r.pageY],i(),_=(r,n,e)=>{"m"==n[5]?a=e:_=a=null,i()},k.stop("user")&&p.cmd("pause"))};var c,s,v,l,b,d,t=[];i=()=>{var r,n=W;for(r in a&&(n=n.slice()).push(a),M&&n.map(r=>{var n,e,a,i=r[1]-c;0<=i&&(e=i/v|0)<4&&i-e*v<s&&0<=(n=r[0]-l)&&(a=n/d|0)<10&&n-a*d<b&&(t[a=a<5?3-e|a<<3:4+e|9-a<<3]|=2)}),t){var e=t[r];e&&(e<3&&k.kbd(+r,1<e),t[r]=e>>1)}},D=(r,n,e)=>{var a=r>>7;l=r-10*(d=(r-(c=a))/10|0)+a>>1,(b=d-a)<(s=(v=n-a>>2)-a)&&(v=(s=b)+a);var i=$("#k"),t=0,o=c,u=l;do{var f=i.children[t];f||((f=i.appendChild($e("div"))).textContent="1234567890QWERTYUIOPASDFGHJKL\u21b5\u21e7ZXCVBNM\u25c6 "[t]);f=f.style}while(f.top=o+"px",f.left=u+"px",f.width=b+"px",f.height=s+"px",u+=d,++t%10||(o+=v,u=l),t<40);c+=e}}();var H,t,j,X={};function Y(r){var n=w.hash.substr(1),e=$("#bb");if(r||n!=e.value){e.value=n;var a=decodeURIComponent,i={},t=n.match(/^!([^#]+)#?(.*)/);return t&&(i["!"]=a(t[1]),n=t[2]),n.split(/#/).map(r=>{r&&((t=r.match(/^(~?)([^=./]+)(?:=([^#]*))?$/))?(v=!t[1]&&(null==t[3]||a(t[3])),i[t[2]]=v):i.l||(i.l=r))}),i}}function Z(r){var n,e,a,i,t,o;r&&((t=X).u!=r.u&&(t.u=a=r.u,(n=$("[data-for=userg]")).hidden=!a,n.style.display=a?"":"none",function(r,n){var o,u=cr(r);u.rq&&u.rq.abort();null!=n&&(u.act=ur,(o=$e("a")).href=n,u.rq=request({url:o.href},{text:1,acc:y+",text/plain,text/html",color:"#EC0"},function(r){if(r.eof){delete u.rq,u.ul.innerHTML="";var n=r.type,e=r.data;if(e&&n){var a,n=n.replace(/ *;.*/,""),i=f.head,t=$e("base");t.href=r.url,i.insertBefore(t,i.firstChild);try{!function(){if(n==y){if(!(a=JSON.parse(e)).forEach)throw"Not a table"}else a=(a="text/html"==n?((a=$e("div")).innerHTML=e,[].map.call(a.querySelectorAll("a:not([rel=up])"),r=>({url:r.href,name:r.textContent}))):e.split(/\n+/).map(r=>{r=r.match(/^(\S+)\s*(.*)/);if(r)return{url:r[1],name:r[2]}})).filter(r=>{if(r&&r.url)return r.name||(r.name=r.url.replace(/.*\//,"")),r})}(),a.forEach(r=>{var n=r.name,r=r.url;n&&r&&vr(u,n+"",{url:(o.href=r,o.href)})})}catch(r){p.msg(r)}i.removeChild(t)}}}),u.ul.innerHTML="\u2652")}("user",a||null),a&&n.focus()),(a=r["!"])&&(i=a.match(/^([a-z0-9]+)(:[a-z0-9]+)?$/))?(t.l=null,p.load("/qaop/bin/"+a,1),or.hasOwnProperty(a)?K():(or[i[1]]=null,request({url:"/qaop/inf/"+i[1]},{text:1,acc:y,nopb:1},function(r){var n=r.data;!n||(n=(r=JSON.parse(n)).id)&&(or[n]=r,K())}))):t.l!=r.l&&(t.l=e=r.l),t={},(a=r[128])!=o&&(t.model=+!!a),(a=r.tc2048)!=o&&(t.tc2048=+!!a),(a=r.ay)!=o&&(t.ay=+!!a),(a=r.speed)!=o&&(t.speed=a),L(t),r.reset&&k.reset(),e&&p.load(e))}function G(r){var n=w.href.replace(/#.*/,"");(r||/^#!/).test(w.hash)&&history.replaceState(null,null,n),onhashchange()}function K(){var r=w.hash.match(/^#!([a-z0-9]+)/),n=t,e=j,a=$("link[rel=manifest]");r&&(n=n||(t=f.title),!e&&a&&(e=j=a.href),(r=or[r[1]])&&(n=r.name+" \u2022 ZX Spectrum online",e="qaop/wam/"+r.id)),n&&(f.title=n),e&&a&&(a.href=e)}function P(){var i=$("link[rel~=icon]"),t=new Image;function r(){var r,n,e=$e("canvas"),a=e.getContext("2d");e.width=r=t.width,e.height=n=t.height,a.drawImage(t,0,0),k.stop("user")&&(a.scale(r/16,n/16),a.fillStyle="#FFF",a.fillRect(9,9,7,7),a.fillStyle="#33C",a.fillRect(10,10,2,5),a.fillRect(13,10,2,5)),(i=(a=i).cloneNode(1)).type="image/png",i.href=e.toDataURL(),pr(a).replaceChild(i,a)}t.src=i.href,t.onload=()=>(P=r)()}function Q(){for(var r,e=cr("snaps"),n=[],a=e.o.slice(),i=0;i<s.length;)/^zx\/./.test(r=s.key(i++))&&n.push(r.substr(3));n.sort(),n=n.filter(r=>{r=a.indexOf(r);if(r<0)return 1;delete a[r]}),a.forEach((r,n)=>lr(e,n)),n.forEach(r=>vr(e,r,r)),e.act=nr}function V(r,n){var e=$("#save");e.href=n,e.textContent=e.download=r,e.click()}function rr(){$(".c-restore").disabled=!fr.snaps.o.length}function nr(r,n,e){var a=this,i=a.o.length;switch(r){case"click":e||$("#c").focus();case"drag":var t=a.o[n]||a.o[i-1],o=t&&s["zx/"+t];if(!t||!o)return;if("drag"==r)return ar(e,t,o);p.load(o);break;case"sel":$(".c-svsna").disabled=$(".c-rmsna").disabled=n<0,0<=n&&mr(a.e[n]);break;case"del":0<=n&&(s.removeItem("zx/"+a.o[n]),lr(a,n),rr())}}function er(r){return"data:application/x.zx.z80;base64,"+btoa(n(r||k.zx.getState()))}function ar(r,n,e,a,i){if(e=e||er(),r.setData("URL",e),!a){if(!(a=e.match(/^data:([^,;]+)/)))return;a=a[1]}(i=i||k.getType(a))&&r.setData("DownloadURL",a+":"+(n=(n||"snapshot")+"."+i).replace(/:/g,"")+":"+e)}function ir(r){var i,n,e=T,t=r.pageX;switch(r.type){case"keydown":(n={33:1,34:-1,37:-1,38:1,39:1,40:-1}[r.keyCode])&&(a(e+.1*n),i=1);break;case"mousedown":if(n=$("#vol>*>*>*").getBoundingClientRect(),(t-=n.left)<0||t>=n.width)return;t-=n.width/2,_=(r,n,e)=>{var a;o(e[0]-t),i=1,"mouseup"==n&&(i&&(a=onclick,onclick=null,m(()=>onclick=a)),_=null)};break;case"click":o(t)}return i;function o(r){var n=$("#vol>*").getBoundingClientRect();a((r-n.left)/n.width)}function a(r){L({volume:r<0?0:1<r?1:r})}}function tr(a){[].forEach.call(pr(a).children,function(r){var n=r.getAttribute("data-for"),e=r==a;kr(r,"active",e),r.tabIndex=e-1,n&&($("#"+n).style.visibility=e?"visible":"hidden")})}onappinstalled=()=>p.msg("Installed");var or={};function ur(r,n){"click"==r&&($("#bb").value="",(n=this.o[n]).id?(w.hash="#!"+n.id,onhashchange()):p.load(n.url),$("#c").focus())}var fr={snaps:{ul:$("#snaps")},user:{ul:$("#userg")}};function cr(r){r=fr[r];return r.e=[],r.o=[],r.sel=-1,r.ul.innerHTML="",r}function sr(r,e){0<=e&&mr(r.e[e]),r.e.forEach((r,n)=>kr(r,"sel",n==e)),r.act("sel",r.sel=e)}function vr(r,n,e){var a=$e("li"),i=a.appendChild($e("a"));return i.textContent=n,r.ul.appendChild(a),r.e.push(a),i.draggable=!0,r.o.push(e)-1}function lr(r,n){r.ul.removeChild(r.e[n]),r.e.splice(n,1),r.o.splice(n,1);var e=r.sel;sr(r,e-=n<e||e==n&&n==r.e.length)}function br(r,n){if(e=function(r){var n,e,a,i;for(i in hr(r,".ls>li>a")?r=pr(n=pr(e=r)):hr(r,".ls>li")&&(r=pr(r)),fr)if((a=fr[i]).ul==r)return{l:a,i:a.e.indexOf(n),e:n,a:e}}(r.target)){var e,a=e.l,i=e.i,t=a.sel;switch(n||r.type){case"click":t=i;case"click+focus":0<=i&&!(1<r.which)&&a.act("click",i,r.ctrlKey);break;case"hover":0<=i&&(t=i);break;case"keydown":switch(r.keyCode){case 38:0<t&&t--;break;case 40:t+1<a.e.length&&t++;break;case 13:0<=t&&a.act("click",t,r.ctrlKey);break;case 46:return a.act("del",t),1;case 27:t=-1;break;default:return void a.act("key",-1,r)}dr(r);break;case"dragstart":if((t=i)<0)break;a.act("drag",i,r.dataTransfer)}return a.sel!=t&&sr(a,t),1}}function dr(r){r.preventDefault()}function pr(r){return r.parentNode}addEventListener("transitionend",function(){kr(u,"-anim")})}(ui,emu,window,document),setTimeout(function(r,n){r=r("L3RvcmluYWsu"),(!n||n.href.indexOf(r)<0)&&emu.stop(r,1)},1e6,atob,$("a[rel=author]")),ld(function(r){var v=this;v.cpu=new r(v),v.devs=[],v.keyboard=[255,255,255,255,255,255,255,255];var u,f,l,c,t,s,b,d,p,k,h,m,$,w=24;function n(r){var n,e,a,i,t=r.pFE,o=16384;if(t!=u&&(g=t),t=r.border,i=7&((n=g)^(g=t!=u?248&n|t:g)),X=7&g,"rom"in r&&(h=r.rom),t=r.model,(n=r.p7FFD)!=+n&&(n=_),t!=u&&(w=-26&w|0<(t=5==t?t:+!!t)|(t<5?24:0),l=(f=[[69888,14335,224,32],[70908,14361,228,32],,,,[71680,17989,224,36]][t])[2],c=191*l+126,k=v.rom128[1],1&w||(k=v.rom48k,d!=p[0]&&y(p[0]=bytes(o),0,d,0,o),n=48)),i|=8&(n^_),S(n),t=r.tc2048,n=r.pFF,t==u&&!r.model||(w=-5&w|t<<2,t||(n|=0)),n==+n&&(z=n),(t=r.cont)!=u&&(w&=-9,m&=-16,t&&(w|=8,m|=2|(1&_)<<3)),(t=r.fbus)!=u&&(w=-17&w|!!t<<4),(t=r.joy)!=u&&(t?v.joy&=255:v.joy=u),t=r.ram)if(i=1,8<(a=t.length))y(s,0,t,0,o),y(b,0,t,o,o),y(d,0,t,32768,o);else for(;a;)(e=t[--a])&&p[a]!=e&&y(p[a],0,e,0,o);if(""===(t=(t=r.ay)==u?r.model:t)&&(t=!!kr,kr=u),t){if(kr||(kr={idx:0,reg:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],volt:[0],avol:0,bvol:0,cvol:0,mix:0,gen:0,aper:0,bper:0,cper:0,nper:0,eper:0,dis:0,ech:0,ekeep:0,ealt:0,eattack:0,estep:0,ecnt:0,noise:1},mr()),t.reg)for(n=0;n<15;n++)t.reg[n]!=u&&$r(n,0|t.reg[n]);(n=t.idx)!=u&&(kr.idx=15&n)}else t!=u&&(kr=u);(t=r.time)==+t&&(v.time=t-f[1]),i&&G&&(i=v.time,x(2),v.time=i),v.cpu.setState(r)}function y(r,n,e,a,i){for(;r[n++]=0|e[a++],--i;);}function x(r){K||i(),J=(1&z)<<13,I=0,D=L*nr,M=L*(F+32+F)+F-1;var n=-l*L-4*F+4;H=-F,j=-L,B=n,2&r&&(W(e=v.time),Z(e));var e,a=f[0]-f[1];1&r?(4&w&&64&z||(v.int=255,v.time_limit=f[3]-f[1],v.cpu.execute()),v.int=-1,v.time_limit=a,v.cpu.execute()):v.time=a,2&r&&(W(e=v.time),X!=Y&&(r=B,Z(e),r==n&&(Y=X)),R&&tr(R)),v.time-=f[0]}v.init=()=>{p=[];for(var r=0;r<8;r++)p[r]=bytes(16384);for(t=rom=k,s=p[5],b=p[2],d=p[0],m=226,$=s,n({model:0}),v.time=-f[1],r=6144;r<6912;)s[r++]=7;for(E=[],r=N*A/8;E[--r]=0,r;);G&&ir()},v.reset=()=>{v.cpu.reset(),X=0,S(1&w?0:48);for(var r,n=v.time,e=v.devs,a=e.length,i=0;i<a;i++)(r=e[i]).reset&&r.reset(n)},v.canvas=(r,n)=>{K=null,G=r.getContext("2d"),Q=n||1,E&&ir()},v.getState=r=>{var n,e,a=v.cpu.getState(),i=16384;if(a.pFE=g,a.border=X,a.p7FFD=_,a.model=1&w&&(8&w?1:5),a.tc2048=!!(4&w),a.cont=!!(8&w),a.fbus=!!(16&w),a.joy=v.joy!=u,a.pFF=z,a.ay=kr&&{idx:kr.idx,reg:kr.reg.slice()},a.time=v.time+f[1],a.frt=f[0],1==r)y(n=bytes(3*i),0,s,0,i),y(n,i,b,0,i),y(n,32768,d,0,i);else for(n=[],e=0;e<8;e++)n[e]=p[e],1<r&&y(n[e]=bytes(i),0,p[e],0,i);return a.ram=n,h&&(a.rom=h),a},v.setState=n,v.frame=r=>{if(!--O){O=16;for(var n=128;n<256;n++){var e=C[n];C[n]=e=e<<4&61440|e>>4&3840}}for(var a=v.time,i=f[0],n=0,t=v.devs,o=t.length;n<o;n++){var u=t[n];u.frame&&u.frame(i,a,r)}or=50*i,x(r),er&&(pr(i+a),vr=a)},v.time=v.time_limit=0,v.m1=(r,n)=>{var e,a=r<32768?r<16384?(e=t,1):(e=s,2):r<49152?(e=b,4):(e=d,8),i=v.time-o;return 0<i&&T(i),m&a&&U(0),o=m&1<<(n>>14)?v.time+4:99999,e[16383&r]},v.get=r=>{var n,e=r<32768?r<16384?(n=t,1):(n=s,2):r<49152?(n=b,4):(n=d,8),a=v.time-o;return 0<a&&T(a),o=99999,m&e&&(U(0),o=v.time+3),n[16383&r]},v.put=(r,n)=>{var e,a=m;r<32768?r<16384?(e=t,a&=17):(e=s,a&=34):r<49152?(e=b,a&=68):(e=d,a&=136);var i=v.time-o;0<i&&T(i),o=99999,a&&(15&a&&(U(0),o=v.time+3),e[r&=16383]!==n&&(e===$&&W(v.time),e[r]=n))},v.get16=r=>{var n,e=16383&r;if(16383==e){var a=v.get(r);return v.time+=3,a|=v.get(r+1&65535)<<8,v.time-=3,a}a=r<32768?r<16384?(n=t,1):(n=s,2):r<49152?(n=b,4):(n=d,8),r=v.time-o;return 0<r&&T(r),o=99999,m&a&&(U(0),U(3),o=v.time+6),n[e]|n[1+e]<<8};var o,g=0,_=48,z=0;function S(r){d=p[7&(_=r)],m=8&w?226|r<<3&8:224,$=p[5|r>>2&2],t=16&r?h||k:v.rom128[0]}function U(r){(r+=v.time)<0||c<=r||(r%=l)<126&&0<(r=6-(7&r))&&(v.time+=r)}function T(r){var n,e,a=o;if(!(a+r<=0||(n=c-a)<0)){if(126<(n%=l)){if((r-=n-126)<=0)return;a=6,e=15}else{if(e=n>>3,7==(n&=7)&&(n--,!--r))return;a=n}v.time+=a+6*(r=e<(r=r-1>>1)?e:r)}}function q(r){var n=v.time-o,e=1&r;0<n&&T(n),o=8&w?r>>14^1?(e||U(1),99999):(o=v.time,T(1+e<<1),v.time+4):99999}v.inp=r=>{q(r);var n,e,a,i,t,o,u=65535,f=v.time,c=v.devs,s=c.length;for(31==(255&r)&&null!=(n=v.joy)&&(u=n),a=0;a<s;a++)(r&(i=c[a]).imask)==i.iport&&(u&=i.inp(r,f));if(u<256)return u;if(n=255,1&r)kr&&49152==(49154&r)?n=kr.reg[kr.idx]:!(255&~r)&&4&w?n=z:0<=f&&16&w&&(o=f/l,f%=l,o<192&&f<124&&!(4&f)&&(t=f>>1&1|f>>2,n=$[t+=1&f?6144|o<<2&992:6144&o|o<<2&224|o<<8&1792]));else for(n=g<<2&64|160&n|31,e=r>>8^255,a=0;e;a++)1&e&&(n&=v.keyboard[a]),e>>=1;return u&=n|u>>8^255,32770&r||32&_||(8&(_^u)&&W(f),S(u)),u},v.out=(r,n)=>{q(r);for(var e,a=v.time,i=v.devs,t=i.length,o=0;o<t;o++){var u=i[o];(r&u.omask)==u.oport&&u.out(r,n,a)}if(1&r||((e=7&n)!=X&&(Z(a),X=e),24&(g^n)&&pr(a+(n>>1&8^8)),g=n),!(2&r))if(r<32768){if(32&_)return;8&(_^n)&&W(a),S(n)}else kr&&(r<49152?(pr(a),$r(kr.idx,n),dr(0,kr.level-(kr.level=xr()))):kr.idx=15&n);!(255&~r)&&4&w&&(W(a),J=8191&J|(1&n)<<13,z=n)},v.halt=(r,n)=>r;var F=4,L=28,N=8*(F+32+F),A=L+192+L;v.dim=[N,A];var C,E,O=16,R=0,I=0,J=0,M=0,D=0;function W(r){if(!(r<I)){var n=J,e=I,a=M,i=D,t=1<<(n>>5&7|n>>8&24),o=3&z,u=o<2?(-256&n)-(n>>3&768)-6144:3^o&&-8192;do{if(o=C[$[n-u]]|$[n++],E[++a]!==o&&(E[a]=o,rr(a,i,o),R|=t),o=C[$[n-u]]|$[n++],E[++a]!==o&&(E[a]=o,rr(a,i,o),R|=t),e+=8,!(31&n)){if(e+=l-128,a+=2*F,i+=nr,n+=224,2&z){if(1792&n)continue;if(t<<=1,224&(n-=2016))continue}else{if(u+=256,1792&n)continue;if(u-=2048,t<<=1,224&(n-=2016))continue;u+=1792}if(6144<=(8191&(n+=1792))){e=99999;break}}}while(e<=r);J=n,I=e,M=a,D=i}}var B=0,H=0,j=0,X=0,Y=-1;function Z(r){var n=B;if(!(r<n)){Y=-1;var e=H,a=j,i=nr*(a+L),t=F+(F+32+F)*L+(F+32+F)*a+e,o=C[X<<3];do{if(E[t]!==o&&(E[t]=o,rr(t,i,o),R=-1),t++,n+=4,!++e&&0<=a&&a<192)t+=e=32,n+=128;else if(32+F<=e){if(e=-F,++a==8*(24+L)){n=99999;break}n+=l-4*(F+32+F),i+=nr}}while(n<=r);H=e,j=a,B=n}}var G,K,P,Q,V,rr,nr,er,e=0;function i(){var r,n=Q;for(K=G.createImageData(N,n*A),r=(P=K.data).length-1;0<r;r-=4)P[r]=255;for(V=[[[0,11406853,198,11996364,311808,12373765,1032645,12963275,0,12065042,1316055,13708518,3008039,15268407,4781817,16777215],[0,11734533,203,12324305,313344,12702725,1099466,13292240,0,12392978,1381853,14101996,3075113,15662904,4914431,16777215,0,11144453,192,11668422,244992,12044549,965823,12568517,0,11737105,1250258,13314784,2875430,14873909,4648946,16777215]],[[0,3158063,7302765,8750211,10197401,11710640,12434362,13750479,0,3815737,8223867,10263450,12303033,14408409,15987184,16777215],[0,3289393,7500145,9013383,10460573,12039604,12763327,14144980,0,3881786,8421247,10526622,12631998,14802910,16381942,16777215,0,3092014,7105386,8552576,9868692,11381675,12105397,13421257,0,3684151,7960696,10000022,11974068,14079187,15526633,16777215]]][e][--n].map(r=>r|-1<<24),C=[],r=0;r<128;r++)C[128|r]=C[r]=(r<<1&240|r>>3&8|7&r)<<8;nr=n*N,P=new Uint32Array(P.buffer),rr=[a,ar][n]}function a(r,n,e){var a=P,i=V[e>>12],t=V[e>>8&15];for(r*=8;a[r++]=128&e?t:i,e<<=1,7&r;);}function ar(r,n,e){var a=P,i=e>>12,t=e>>8&15,o=V[i],u=V[t]^o;for(i=V[i+16],t=V[16+t]^i,e^=e>>1&127,n+=8*r;128&e&&(o^=u,i^=t),e<<=1,a[n]=o,a[n+N]=i,7&++n;);}function ir(){K||i();for(var r,n=0,e=0,a=0;a<192+2*L;a++){for(r=0;r<32+2*F;r++,n++)rr(n,e,E[n]);e+=nr}tr(-1)}function tr(r){var n=G,e=n.canvas,a=e.width-N>>1,i=e.height-Q*A>>1;if(r<(R=0))return n.putImageData(K,a,i);e=t(r),r=t(r^r-1);function t(r){var n=0;return 65535<r&&(r>>=n=16),255<r&&(r>>=8,n+=8),15<r&&(r>>=4,n+=4),n+(-21936>>2*r&3)}n.putImageData(K,a,i,8*F-1,Q*(8*r+L)-1,258,8*Q*(e-r+1)+2)}this.bw=r=>(e=+(r=r===u?!e:r),i(),ir(),!!r);var or,ur,fr,cr,sr=0,vr=0,lr=0;function br(){return 16&g?8&g?cr:fr:0}function dr(r,n){if(er){var e=sr*n/or,a=er.v,i=er.k,t=er.h;a[i]+=e,a[i=i+1&t]+=n-e;e=i;for(r=sr-ur*r;r<0;)r+=or,a[i=i+1&t]=0;sr=r,(er.p-e&t)<=(i-e&t)&&(er.p=i+1&t),er.k=i-1&t}}function pr(r){var n,e=vr,a=br(),i=a-lr;if(lr=a,kr){for((n=hr)||(i+=yr(kr),n+=16),n+=e;n<r;)(a=yr(kr))&&(dr(n-e,i),e=n,i=a),n+=16;hr=n-r}dr(r-e,i),vr=r}v.audio=r=>{(er=r)&&(ur=r.hz)},(v.volume=r=>{fr=.93*(cr=r*=r),kr&&mr(),lr=br()})(.5);var kr,hr=0;function mr(){var r=cr,n=kr.volt,e=15;for(n[e]=r;n[--e]=r*[0,14,20,29,42,62,85,137,169,265,353,450,570,687,848][e]/1e3,1<e;);for(e=8;e<11;e++)$r(e,kr.reg[e]);kr.level=xr()}function $r(r,n){switch(r){case 0:kr.aper=3840&kr.aper|n;break;case 1:kr.aper=255&kr.aper|(n&=15)<<8;break;case 2:kr.bper=3840&kr.bper|n;break;case 3:kr.bper=255&kr.bper|(n&=15)<<8;break;case 4:kr.cper=3840&kr.cper|n;break;case 5:kr.cper=255&kr.cper|(n&=15)<<8;break;case 6:kr.nper=n&=31;break;case 7:kr.mix=~(n|kr.dis);break;case 8:case 9:case 10:var e=n&=31,a=9<<r-8;n?n<16?(kr.dis&=a=~a,kr.ech&=a):(kr.dis&=~a,kr.ech|=a,e=kr.estep^kr.eattack):(kr.dis|=a,kr.ech&=~a),kr.mix=~(kr.reg[7]|kr.dis),e=kr.volt[e],r<9?kr.avol=e:9<r?kr.cvol=e:kr.bvol=e;break;case 11:kr.eper=65280&kr.eper|n;break;case 12:kr.eper=255&kr.eper|n<<8;break;case 13:kr.ekeep=1&(n=(n&=15)<8?n<4?1:7:n)?1:-1,kr.ealt=n+1&2?15:0,kr.eattack=4&n?15:0,kr.estep=15,kr.ecnt=-1,wr()}kr.reg[r]=n}function wr(){var r,n=kr.ech;n&&(r=kr.volt[kr.estep^kr.eattack],1&n&&(kr.avol=r),2&n&&(kr.bvol=r),4&n&&(kr.cvol=r))}function yr(r){var n,e=0;return--r.acnt&r.aper||(r.acnt=-1,e^=1),--r.bcnt&r.bper||(r.bcnt=-1,e^=2),--r.ccnt&r.cper||(r.ccnt=-1,e^=4),(r.div16^=1)&&(--r.ncnt&r.nper||(r.ncnt=-1,1&(n=r.noise)&&(e^=56,n^=163840),r.noise=n>>1),--r.ecnt&r.eper||(r.ecnt=-1,r.ekeep&&(r.estep||(r.eattack^=r.ealt,r.ekeep>>=1,r.estep=16),r.estep--,r.ech&&(wr(),e|=256)))),r.gen^=e,n=0,n=e&r.mix?r.level-(r.level=xr()):n}function xr(){var r=kr.mix&kr.gen;return(9&r?0:kr.avol)+(18&r?0:kr.bvol)+(36&r?0:kr.cvol)}v.command=(r,n)=>{function i(r,n){[,s,b,d][r>>14][16383&r]=255&n}function e(r,n){i(r,n),i(r+1,n>>8)}function a(r,n,e,a){for(;0<a--;)i(r++,n[e++])}for(var t=v.rom48k,o={i:63,border:7,rom:null,ay:"",iy:23610,im:1,iff:3,model:n=n||0},u=16384;u<22528;u++)i(u,0);for(;u<23296;u++)i(u,56);for(;u<65536;u++)i(u,0);e(23732,--u),a(u-=167,t,15880,168),e(23675,u--),i(23608,64),e(23730,u),e(23606,15360),i(u--,62),e(23613,(o.sp=u)-2),e(23631,23734),a(23734,t,5551,21),u=23754,e(23639,u++),e(23635,u),e(23627,u),i(u++,128),e(23641,u);for(var f=0;f<r.length;f++)i(u++,r.charCodeAt(f));e(u,32781),e(23649,u+=2),e(23651,u),e(23653,u),i(23693,56),i(23695,56),i(23624,56),e(23561,1315),i(23552,255),i(23556,255),a(23568,t,5574,14),e(23688,6177),i(23659,2),e(23656,23698),i(23611,12),o.pc=4788,n&&(a(23296,v.rom128[0],107,88),i(23389,207),e(23427,60396),e(23429,11244),i(23431,1),(n=p[7])[u=11254]=n[u+2]=0,n[u+1]=192,n[11285]=20,n[14067]=20,n[15723]=5,n[(u=11279)-1]=255,n[u]=n[u+2]=56,e(o.sp,6932),e(23425,u=23539),a(u,[231,63,43,39,231,63,122,38,49,13,103,38],0,12),o.p7FFD=0,o.pc=619),i(23672,u=32768*Math.random()|0),o.r=u>>8,v.setState(o)}},function(t){var o,u,f,c,s,v,n,l,b,i,d,p,k,h,e,a,m,$,w,y,x,g,_,z,S,U,T,q,F,L;function N(){var r=168&f|f>>8&1|!c<<6,n=s,e=v>>8,a=c^n;return r|=2&e,(r|=16&(a^v^e))|4&(n=256&n?154020>>(15&(c^c>>4)):(a&(v^c))>>5)}function A(r){c=64&~r,f=r|=r<<8,s=255&(v=-129&r|(4&r)<<5)}function C(r){S=65280&S|r,U=127&r}function E(r){l=r>>8,b=255&r}function O(r){i=r>>8,d=255&r}function R(){var r=y;y=l,l=r,r=x,x=b,b=r,r=g,g=i,i=r,r=_,_=d,d=r,r=z,z=p,p=r}function I(){var r=e;e=u,u=r,r=a,a=f,f=r,r=m,m=c,c=r,r=$,$=s,s=r,r=w,w=v,v=r}function J(r){t.time++,t.put(n-1&65535,r>>8),t.time+=3,t.put(n=n-2&65535,255&r),t.time+=3}function M(){var r=t.get16(n);return n=n+2&65535,t.time+=6,r}function D(r){var n=(s=u)-r;v=~r,f=384&n|40&r,c=255&n}function W(r){return f=256&f|(c=r=(s=r)+(v=1)&255),r}function B(r){return f=256&f|(c=r=(s=r)+(v=-1)&255),r}function H(r){f=256&f|(c=r),s=256|r,v=0}function j(r){f=215&f|296&r,v&=128,s=384&s|16&c,u=255&r}function X(r,n){var e=r+n;return f=128&f|e>>8&296,s&=-17,v=128&v|16&((e^r^n)>>8^c),L=r+1,t.time+=7,65535&e}function Y(){var r=t.get(o);return o=o+1&65535,t.time+=3,r}function Z(){var r=t.get16(o);return o=o+2&65535,t.time+=6,r}function G(r){s&=-17,v=128&v|16&(r>>4^c),f=256^r|128&f|40&u}function K(r){L=Z();r&&(o=L)}function P(){L=o=o+(128^t.get(o))-127&65535,t.time+=8}function Q(r){var n=L=Z();r&&(J(o),o=n)}function V(){L=o=t.get16(n),n=n+2&65535,t.time+=6}function rr(){F=!0;var r=t.time_limit-t.time+3>>2;0<r&&(r=t.halt(r,S|U),U=U+r&127,t.time+=4*r)}function nr(r){var n,e,a;r:for(;;){switch(r){case 221:case 253:break;case 243:q=0;break;case 251:q=3;break;default:mr[r]();break r}if(e=r,r=t.m1(o,S|(U=U+1&127)),o=o+1&65535,t.time+=4,4&e&&(n=$r[r])){null!=(a=n(221==e?k:h))&&(221==e?k=a:h=a);break}}1&q&&0<=t.int&&t.time<t.time_limit&&er()}function er(){var r,n=t.int;U=U+1&127,q=0,F=!1,t.time+=6,T?(J(o),r=56,1<T&&(r=t.get16(65280&S|n),t.time+=6),L=o=r):mr[n]()}function ar(r){var n=t.get(o);return o=o+1&65535,t.time+=8,L=r+(128^n)-128&65535}function ir(r){var n=t.get(o);return o=o+1&65535,t.time+=8,n=t.get(L=r+(128^n)-128&65535),t.time+=3,n}function tr(r,n){n=p+r+(f>>8&1^n);L=p+1,f=n>>8,s=p>>8,v=r>>8,p=n&=65535,c=n>>8|n<<8,t.time+=7}function or(r){f=256&f|(u=r),c=+!!r,s=v=q<<6&128,t.time++}function ur(){var r=l<<8|b,n=t.inp(r);return L=1+r,H(n),t.time+=4,n}function fr(r){var n=l<<8|b;L=1+n,t.out(n,r),t.time+=4}function cr(r,n){var e,a=t.get(e=p);p=e+r&65535,t.time+=3,t.put(e=i<<8|d,a),i=(e+=r)>>8&255,d=255&e,t.time+=5,c=c&&1,f=384&f|8&(a+=u)|a<<4&32,(l=--b<(a=0)?l-1&(b=255):l)|b&&(n&&(t.time+=5,L=1+(o=o-2&65535)),a=128),s=v=a}function sr(r,n){var e,a,i=u-(a=t.get(e=p))&255;L+=r,p=e+r&65535,t.time+=8,c=127&i|i>>7,v=~(128|a),s=127&u,(l=--b<0?l-1&(b=255):l)|b&&(s|=128,v|=128,n&&i&&(L=1+(o=o-2&65535),t.time+=5)),f=256&f|128&i,16&(i^a^u)&&i--,f|=i<<4&32|8&i}function vr(r){var n,e=r>>2,a=p+e&65535,i=l<<8|b;t.time++,1&r?(n=t.get(p),t.time+=3,L=(i=i-256&65535)+e,t.out(i,n),t.time+=4,e=a):(n=t.inp(i),t.time+=4,L=i+e,i=i-256&65535,t.put(p,n),t.time+=3,e+=i),e=(255&e)+n,p=a,l=i>>=8,2&r&&i&&(t.time+=5,o=o-2&65535),r=7&e^i,f=i|(e&=256),s=128^(c=i),v=128&((r=4928640>>(15&(r^r>>4)))^i)|e>>4|(128&n)<<2}function r(){u=c=255&(f=1+(v=~u)),s=0}function lr(){q|=q>>1,V()}function br(){T=0}function dr(){T=1}function pr(){T=2}function kr(r,n){switch(r){case 0:n=257*n>>7;break;case 1:n=n>>1|(1+(1&n)^1)<<7;break;case 2:n=n<<1|f>>8&1;break;case 3:n=(513*n|256&f)>>1;break;case 4:n<<=1;break;case 5:n=(513*n+128^128)>>1;break;case 6:n=n<<1|1;break;case 7:n=513*n>>1}return s=256|(c=n=255&(f=n)),v=0,n}function hr(r,n){f=256&f|40&n|(n&=1<<r),s=~(c=n),v=0}this.env=t,o=S=U=T=q=0,n=k=h=p=z=65535,u=l=b=i=d=e=y=x=g=_=255,f=c=s=v=a=m=$=w=0,F=!1,this.getState=()=>{var r={pc:o,a:u,f:N(),sp:n,bc:l<<8|b,de:i<<8|d,hl:p,ix:k,iy:h,bc_:y<<8|x,de_:g<<8|_,hl_:z,a_:e,r:128&S|U,i:S>>8,im:T,iff:q,halted:F};return I(),r.f_=N(),I(),r},this.setState=r=>{"pc"in r&&(o=r.pc),"a"in r&&(u=r.a),"f"in r&&A(r.f),"sp"in r&&(n=r.sp),"bc"in r&&E(r.bc),"de"in r&&O(r.de),"hl"in r&&(p=r.hl),"ix"in r&&(k=r.ix),"iy"in r&&(h=r.iy),R(),I(),"bc_"in r&&E(r.bc_),"de_"in r&&O(r.de_),"hl_"in r&&(p=r.hl_),"a_"in r&&(u=r.a_),"f_"in r&&A(r.f_),R(),I(),"r"in r&&C(r.r),"i"in r&&(S=255&S|r.i<<8),"im"in r&&(T=3&r.im),"iff"in r&&(q=r.iff),"halted"in r&&(F=!!r.halted)},this.execute=()=>{if(!(t.time>=t.time_limit)){if(1&q&&0<=t.int&&er(),F)return rr();do{var r=t.m1(o,S|(U=U+1&127))}while(o=o+1&65535,t.time+=4,mr[r](),t.time<t.time_limit)}},this.nmi=()=>{q&=2,F=!1,J(o),t.time+=4,o=102},this.reset=()=>{F=!1,o=S=U=T=q=0};var mr=[r=>r,r=>(r=Z(),l=r>>8,b=255&r),r=>(L=1+(r=l<<8|b)&255|u<<8,t.put(r,u),t.time+=3),r=>(255<++b&&(l=l+1&255,b=0),t.time+=2),r=>l=W(l),r=>l=B(l),r=>l=Y(),r=>j(257*u>>7),I,r=>p=X(p,l<<8|b),r=>(L=1+(r=l<<8|b),u=t.get(r),t.time+=3),r=>(--b<0&&(l=l-1&(b=255)),t.time+=2),r=>b=W(b),r=>b=B(b),r=>b=Y(),r=>j(u>>1|(1+(1&u)^1)<<7),r=>(t.time++,r=t.get(o++),t.time+=3,(l=l-1&255)&&(t.time+=5,L=o=o+(128^r)-128&65535)),r=>(r=Z(),i=r>>8,d=255&r),r=>(L=1+(r=i<<8|d)&255|u<<8,t.put(r,u),t.time+=3),r=>(255<++d&&(i=i+1&255,d=0),t.time+=2),r=>i=W(i),r=>i=B(i),r=>i=Y(),r=>j(u<<1|f>>8&1),P,r=>p=X(p,i<<8|d),r=>(L=1+(r=i<<8|d),u=t.get(r),t.time+=3),r=>(--d<0&&(i=i-1&(d=255)),t.time+=2),r=>d=W(d),r=>d=B(d),r=>d=Y(),r=>j((513*u|256&f)>>1),r=>(c?P:Y)(),r=>p=Z(),r=>(r=Z(),t.put(r,255&p),t.time+=3,L=r+1&65535,t.put(L,p>>8),t.time+=3),r=>(p=p+1&65535,t.time+=2),r=>p=255&p|W(p>>8)<<8,r=>p=255&p|B(p>>8)<<8,r=>p=255&p|Y()<<8,function(){var r=153<(u|256&f)?352:0;9<(15&u|16&(c^s^v^v>>8))&&(r+=6),s=256|u,512&v?(u-=r,v=~r):u+=v=r,f=(c=u&=255)|256&r},r=>(c?Y:P)(),r=>p=X(p,p),r=>(r=Z(),L=r+1,p=t.get16(r),t.time+=6),r=>(p=p-1&65535,t.time+=2),r=>p=-256&p|W(255&p),r=>p=-256&p|B(255&p),r=>p=-256&p|Y(),function(){f=384&f|40&(u^=255),v|=-129,s=384&s|16&~c},r=>(256&f?Y:P)(),r=>n=Z(),r=>(r=Z(),L=r+1&255|u<<8,t.put(r,u),t.time+=3),r=>(n=n+1&65535,t.time+=2),r=>(r=W(t.get(p)),t.time+=4,t.put(p,r),t.time+=3),r=>(r=B(t.get(p)),t.time+=4,t.put(p,r),t.time+=3),r=>(t.put(p,Y()),t.time+=3),r=>G(0),r=>(256&f?P:Y)(),r=>p=X(p,n),r=>(r=Z(),L=r+1,u=t.get(r),t.time+=3),r=>(n=n-1&65535,t.time+=2),r=>u=W(u),r=>u=B(u),r=>u=Y(),r=>G(256&f),r=>r,r=>l=b,r=>l=i,r=>l=d,r=>l=p>>8,r=>l=255&p,r=>(l=t.get(p),t.time+=3),r=>l=u,r=>b=l,r=>r,r=>b=i,r=>b=d,r=>b=p>>8,r=>b=255&p,r=>(b=t.get(p),t.time+=3),r=>b=u,r=>i=l,r=>i=b,r=>r,r=>i=d,r=>i=p>>8,r=>i=255&p,r=>(i=t.get(p),t.time+=3),r=>i=u,r=>d=l,r=>d=b,r=>d=i,r=>r,r=>d=p>>8,r=>d=255&p,r=>(d=t.get(p),t.time+=3),r=>d=u,r=>p=255&p|l<<8,r=>p=255&p|b<<8,r=>p=255&p|i<<8,r=>p=255&p|d<<8,r=>r,r=>p=255&p|(255&p)<<8,r=>(p=255&p|t.get(p)<<8,t.time+=3),r=>p=255&p|u<<8,r=>p=-256&p|l,r=>p=-256&p|b,r=>p=-256&p|i,r=>p=-256&p|d,r=>p=-256&p|p>>8,r=>r,r=>(p=-256&p|t.get(p),t.time+=3),r=>p=-256&p|u,r=>(t.put(p,l),t.time+=3),r=>(t.put(p,b),t.time+=3),r=>(t.put(p,i),t.time+=3),r=>(t.put(p,d),t.time+=3),r=>(t.put(p,p>>8),t.time+=3),r=>(t.put(p,255&p),t.time+=3),rr,r=>(t.put(p,u),t.time+=3),r=>u=l,r=>u=b,r=>u=i,r=>u=d,r=>u=p>>8,r=>u=255&p,r=>(u=t.get(p),t.time+=3),r=>r,r=>u=c=255&(f=(s=u)+(v=l)),r=>u=c=255&(f=(s=u)+(v=b)),r=>u=c=255&(f=(s=u)+(v=i)),r=>u=c=255&(f=(s=u)+(v=d)),r=>u=c=255&(f=(s=u)+(v=p>>8)),r=>u=c=255&(f=(s=u)+(v=255&p)),r=>(u=c=255&(f=(s=u)+(v=t.get(p))),t.time+=3),r=>u=c=255&(f=2*(s=v=u)),r=>u=c=255&(f=(s=u)+(v=l)+(f>>8&1)),r=>u=c=255&(f=(s=u)+(v=b)+(f>>8&1)),r=>u=c=255&(f=(s=u)+(v=i)+(f>>8&1)),r=>u=c=255&(f=(s=u)+(v=d)+(f>>8&1)),r=>u=c=255&(f=(s=u)+(v=p>>8)+(f>>8&1)),r=>u=c=255&(f=(s=u)+(v=255&p)+(f>>8&1)),r=>(u=c=255&(f=(s=u)+(v=t.get(p))+(f>>8&1)),t.time+=3),r=>u=c=255&(f=2*(s=v=u)+(f>>8&1)),r=>u=c=255&(f=(s=u)+(v=~l)+1),r=>u=c=255&(f=(s=u)+(v=~b)+1),r=>u=c=255&(f=(s=u)+(v=~i)+1),r=>u=c=255&(f=(s=u)+(v=~d)+1),r=>u=c=255&(f=(s=u)+(v=~(p>>8))+1),r=>u=c=255&(f=(s=u)+(v=~(255&p))+1),r=>(u=c=255&(f=(s=u)+(v=~t.get(p))+1),t.time+=3),r=>(v=~(s=u),u=c=f=0),r=>u=c=255&(f=(s=u)+(v=~l)+(f>>8&1^1)),r=>u=c=255&(f=(s=u)+(v=~b)+(f>>8&1^1)),r=>u=c=255&(f=(s=u)+(v=~i)+(f>>8&1^1)),r=>u=c=255&(f=(s=u)+(v=~d)+(f>>8&1^1)),r=>u=c=255&(f=(s=u)+(v=~(p>>8))+(f>>8&1^1)),r=>u=c=255&(f=(s=u)+(v=~(255&p))+(f>>8&1^1)),r=>(u=c=255&(f=(s=u)+(v=~t.get(p))+(f>>8&1^1)),t.time+=3),r=>(v=~(s=u),u=c=255&(f=(f>>8&1^1)-1)),r=>(s=~(u=f=c=u&l),v=0),r=>(s=~(u=f=c=u&b),v=0),r=>(s=~(u=f=c=u&i),v=0),r=>(s=~(u=f=c=u&d),v=0),r=>(s=~(u=f=c=u&p>>8),v=0),r=>(s=~(u=f=c=u&p&255),v=0),r=>(s=~(u=f=c=u&t.get(p)),v=0,t.time+=3),r=>(s=~(f=c=u),v=0),r=>(s=256|(u=f=c=u^l),v=0),r=>(s=256|(u=f=c=u^b),v=0),r=>(s=256|(u=f=c=u^i),v=0),r=>(s=256|(u=f=c=u^d),v=0),r=>(s=256|(u=f=c=u^p>>8),v=0),r=>(s=256|(u=f=c=u^255&p),v=0),r=>(s=256|(u=f=c=u^t.get(p)),v=0,t.time+=3),r=>(u=f=c=v=0,s=256),r=>(s=256|(u=f=c=u|l),v=0),r=>(s=256|(u=f=c=u|b),v=0),r=>(s=256|(u=f=c=u|i),v=0),r=>(s=256|(u=f=c=u|d),v=0),r=>(s=256|(u=f=c=u|p>>8),v=0),r=>(s=256|(u=f=c=u|255&p),v=0),r=>(s=256|(u=f=c=u|t.get(p)),v=0,t.time+=3),r=>(s=256|(f=c=u),v=0),r=>D(l),r=>D(b),r=>D(i),r=>D(d),r=>D(p>>8),r=>D(255&p),r=>(D(t.get(p)),t.time+=3),r=>D(u),r=>(t.time++,c&&V()),r=>(r=M(),l=r>>8,b=255&r),r=>K(c),r=>L=o=Z(),r=>Q(c),r=>J(l<<8|b),r=>u=c=255&(f=(s=u)+(v=Y())),r=>(J(o),L=o=0),r=>(t.time++,!c&&V()),V,r=>K(!c),function(){var r,n,e=t.m1(o,S|(U=U+1&127));o=o+1&65535,t.time+=4,r=7&(n=e>>3),n=8&n|7&e,e<128?yr[n](r):xr[n](1<<r)},r=>Q(!c),r=>(r=Z(),J(o),L=o=r),r=>u=c=255&(f=(s=u)+(v=Y())+(f>>8&1)),r=>(J(o),L=o=8),r=>(t.time++,!(256&f)&&V()),r=>(r=M(),i=r>>8,d=255&r),r=>K(!(256&f)),r=>(r=Y()|u<<8,t.out(r,u),L=1+r&255|65280&r,t.time+=4),r=>Q(!(256&f)),r=>J(i<<8|d),r=>u=c=255&(f=(s=u)+(v=~Y())+1),r=>(J(o),L=o=16),r=>(t.time++,256&f&&V()),R,r=>K(256&f),r=>(r=Y()|u<<8,u=t.inp(r),L=1+r,t.time+=4),r=>Q(256&f),r=>nr(221),r=>u=c=255&(f=(s=u)+(v=~Y())+(f>>8&1^1)),r=>(J(o),L=o=24),r=>(t.time++,4&N()^4&&V()),r=>p=M(),r=>K(4&N()^4),r=>(L=M(),J(p),p=L,t.time+=2),r=>Q(4&N()^4),r=>J(p),r=>(s=~(u=f=c=u&Y()),v=0),r=>(J(o),L=o=32),r=>(t.time++,4&N()&&V()),r=>o=p,r=>K(4&N()),r=>(r=p,p=i<<8|d,i=r>>8,d=255&r),r=>Q(4&N()),function(){var r=wr[t.m1(o,S|(U=U+1&127))];o=o+1&65535,t.time+=4,r&&r()},r=>(s=256|(u=f=c=u^Y()),v=0),r=>(J(o),L=o=40),r=>(t.time++,!(128&f)&&V()),r=>function(r){A(255&r),u=r>>8}(M()),r=>K(!(128&f)),r=>nr(243),r=>Q(!(128&f)),r=>J(u<<8|N()),r=>(s=256|(u=f=c=u|Y()),v=0),r=>(J(o),L=o=48),r=>(t.time++,128&f&&V()),r=>(n=p,t.time+=2),r=>K(128&f),r=>nr(251),r=>Q(128&f),r=>nr(253),r=>D(Y()),r=>(J(o),L=o=56)],$r=[,,,,,,,,,r=>X(r,l<<8|b),,,,,,,,,,,,,,,,r=>X(r,i<<8|d),,,,,,,,Z,r=>{L=Z(),t.put(L,255&r),t.time+=3,L=L+1&65535,t.put(L,r>>8),t.time+=3},r=>(t.time+=2,r+1&65535),r=>255&r|W(r>>8)<<8,r=>255&r|B(r>>8)<<8,r=>255&r|Y()<<8,,,r=>X(r,r),r=>(r=Z(),L=r+1,r=t.get16(r),t.time+=6,r),r=>(t.time+=2,r-1&65535),r=>-256&r|W(255&r),r=>-256&r|B(255&r),r=>-256&r|Y(),,,,,,(r,n)=>{r=ar(r),n=W(t.get(r)),t.time+=4,t.put(r,n),t.time+=3},(r,n)=>{r=ar(r),n=B(t.get(r)),t.time+=4,t.put(r,n),t.time+=3},(r,n)=>{r=ar(r),t.time-=5,n=Y(),t.time+=2,t.put(r,n),t.time+=3},,,r=>X(r,n),,,,,,,,,,,r=>{l=r>>8},r=>{l=255&r},r=>{l=ir(r)},,,,,,r=>{b=r>>8},r=>{b=255&r},r=>{b=ir(r)},,,,,,r=>{i=r>>8},r=>{i=255&r},r=>{i=ir(r)},,,,,,r=>{d=r>>8},r=>{d=255&r},r=>{d=ir(r)},,r=>255&r|l<<8,r=>255&r|b<<8,r=>255&r|i<<8,r=>255&r|d<<8,,r=>255&r|(255&r)<<8,r=>{p=255&p|ir(r)<<8},r=>255&r|u<<8,r=>-256&r|l,r=>-256&r|b,r=>-256&r|i,r=>-256&r|d,r=>-256&r|r>>8,,r=>{p=-256&p|ir(r)},r=>-256&r|u,r=>{t.put(ar(r),l),t.time+=3},r=>{t.put(ar(r),b),t.time+=3},r=>{t.put(ar(r),i),t.time+=3},r=>{t.put(ar(r),d),t.time+=3},r=>{t.put(ar(r),p>>8),t.time+=3},r=>{t.put(ar(r),255&p),t.time+=3},,r=>{t.put(ar(r),u),t.time+=3},,,,,r=>{u=r>>8},r=>{u=255&r},r=>{u=ir(r)},,,,,,r=>{u=c=255&(f=(s=u)+(v=r>>8))},r=>{u=c=255&(f=(s=u)+(v=255&r))},r=>{u=c=255&(f=(s=u)+(v=ir(r)))},,,,,,r=>{u=c=255&(f=(s=u)+(v=r>>8)+(f>>8&1))},r=>{u=c=255&(f=(s=u)+(v=255&r)+(f>>8&1))},r=>{u=c=255&(f=(s=u)+(v=ir(r))+(f>>8&1))},,,,,,r=>{u=c=255&(f=(s=u)+(v=~(r>>8))+1)},r=>{u=c=255&(f=(s=u)+(v=~(255&r))+1)},r=>{u=c=255&(f=(s=u)+(v=~ir(r))+1)},,,,,,r=>{u=c=255&(f=(s=u)+(v=~(r>>8))+(f>>8&1^1))},r=>{u=c=255&(f=(s=u)+(v=~(255&r))+(f>>8&1^1))},r=>{u=c=255&(f=(s=u)+(v=~ir(r))+(f>>8&1^1))},,,,,,r=>{s=~(u=f=c=u&r>>8),v=0},r=>{s=~(u=f=c=u&r&255),v=0},r=>{s=~(u=f=c=u&ir(r)),v=0},,,,,,r=>{s=256|(u=f=c=u^r>>8),v=0},r=>{s=256|(u=f=c=u^255&r),v=0},r=>{s=256|(u=f=c=u^ir(r)),v=0},,,,,,r=>{s=256|(u=f=c=u|r>>8),v=0},r=>{s=256|(u=f=c=u|255&r),v=0},r=>{s=256|(u=f=c=u|ir(r)),v=0},,,,,,r=>{D(r>>8)},r=>{D(255&r)},r=>{D(ir(r))},,,,,,,,,,,,,function(r){var n,e,a=L=r+(128^t.get(o))-128&65535;switch(t.time+=3,r=t.get(o+1&65535),o=o+2&65535,t.time+=5,n=t.get(a),t.time+=4,e=r>>3&7,192&r){case 0:n=kr(e,n);break;case 64:return hr(e,n),void(f=384&f|a>>8&40);case 128:n&=~(1<<e);break;case 192:n|=1<<e}switch(t.put(a,n),t.time+=3,7&r){case 0:l=n;break;case 1:b=n;break;case 2:i=n;break;case 3:d=n;break;case 4:p=255&p|n<<8;break;case 5:p=65280&p|n;break;case 7:u=n}},,,,,,,,,,,,,,,,,,,,,,M,,r=>(L=M(),J(r),t.time+=2,L),,J,,,,r=>o=r,,,,,,,,,,,,,,,,r=>(t.time+=2,n=r)],wr=[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,r=>l=ur(),r=>fr(l),r=>tr(~(l<<8|b),1),r=>(r=Z(),t.put(r,b),t.time+=3,L=r+1&65535,t.put(L,l),t.time+=3),r,lr,br,r=>{S=255&S|u<<8,t.time++},r=>b=ur(),r=>fr(b),r=>tr(l<<8|b,0),r=>(r=Z(),L=r+1,r=t.get16(r),l=r>>8,b=255&r,t.time+=6),r,lr,br,r=>{C(u),t.time++},r=>i=ur(),r=>fr(i),r=>tr(~(i<<8|d),1),r=>(r=Z(),t.put(r,d),t.time+=3,L=r+1&65535,t.put(L,i),t.time+=3),r,lr,dr,r=>or(S>>8),r=>d=ur(),r=>fr(d),r=>tr(i<<8|d,0),r=>(r=Z(),L=r+1,r=t.get16(r),i=r>>8,d=255&r,t.time+=6),r,lr,pr,r=>or(128&S|U),r=>p=255&p|ur()<<8,r=>fr(p>>8),r=>tr(~p,1),r=>(r=Z(),t.put(r,255&p),t.time+=3,L=r+1&65535,t.put(L,p>>8),t.time+=3),r,lr,br,function(){var r=t.get(p)|u<<8;t.time+=7,H(u=240&u|15&r),t.put(p,r>>4&255),L=p+1,t.time+=3},r=>p=-256&p|ur(),r=>fr(255&p),r=>tr(p,0),r=>(r=Z(),L=r+1,r=t.get16(r),p=r,t.time+=6),r,lr,br,function(){var r=t.get(p)<<4|15&u;t.time+=7,H(u=240&u|r>>8),t.put(p,255&r),L=p+1,t.time+=3},ur,r=>fr(0),r=>tr(~n,1),r=>(r=Z(),t.put(r,255&n),t.time+=3,L=r+1&65535,t.put(L,n>>8),t.time+=3),r,lr,dr,,r=>u=ur(),r=>fr(u),r=>tr(n,0),r=>(r=Z(),L=r+1,r=t.get16(r),n=r,t.time+=6),r,lr,pr,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,r=>cr(1,0),r=>sr(1,0),r=>vr(4),r=>vr(5),,,,,r=>cr(-1,0),r=>sr(-1,0),r=>vr(-4),r=>vr(-3),,,,,r=>cr(1,1),r=>sr(1,1),r=>vr(6),r=>vr(7),,,,,r=>cr(-1,1),r=>sr(-1,1),r=>vr(-2),r=>vr(-1)],yr=[r=>l=kr(r,l),r=>b=kr(r,b),r=>i=kr(r,i),r=>d=kr(r,d),r=>p=255&p|kr(r,p>>8)<<8,r=>p=-256&p|kr(r,255&p),r=>(r=kr(r,t.get(p)),t.time+=4,t.put(p,r),t.time+=3),r=>u=kr(r,u),r=>hr(r,l),r=>hr(r,b),r=>hr(r,i),r=>hr(r,d),r=>hr(r,p>>8),r=>hr(r,255&p),r=>(hr(r,t.get(p)),f=384&f|L>>8&40,t.time+=4),r=>hr(r,u)],xr=[r=>l&=~r,r=>b&=~r,r=>i&=~r,r=>d&=~r,r=>p&=~(r<<8),r=>p&=~r,r=>(r=t.get(p)&~r,t.time+=4,t.put(p,r),t.time+=3),r=>u&=~r,r=>l|=r,r=>b|=r,r=>i|=r,r=>d|=r,r=>p|=r<<8,r=>p|=r,r=>(r|=t.get(p),t.time+=4,t.put(p,r),t.time+=3),r=>u|=r]})}();
